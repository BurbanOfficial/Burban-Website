<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- META SEO -->
  <meta name="description" content="Access your Burban customer area: manage your personal information, preferences, and loyalty benefits. Join the authentic streetwear movement.">
  <meta name="keywords" content="Burban, customer area, user account, Burban loyalty, streetwear, customer benefits, urban fashion, streetwear shop, official Burban">
  <meta name="author" content="Burban Official">
  <meta name="robots" content="index, follow">

  <!-- TITLE -->
  <title>Burban - Official Customer Area</title>

  <!-- Open Graph (Facebook, WhatsApp) -->
  <meta property="og:type" content="website">
  <meta property="og:title" content="Burban | Official Customer Area">
  <meta property="og:description" content="Log in to your Burban customer area and fully enjoy your loyalty program and exclusive benefits.">
  <meta property="og:url" content="https://burbanofficial.com/account.html">
  <meta property="og:image" content="https://i.imgur.com/CCC34mn.png">

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Burban | Official Customer Area">
  <meta name="twitter:description" content="Easily manage your client profile and access your loyalty benefits on Burban, the streetwear reference.">
  <meta name="twitter:image" content="https://i.imgur.com/CCC34mn.png">

  <!-- Divers -->
  <link rel="canonical" href="https://www.burbanofficial.com/account.html">

  <!-- Fonts -->
  <link href="https://api.fontshare.com/v2/css?f[]=satoshi@400,600,700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;700&display=swap" rel="stylesheet">

  <!-- Favicon minimal -->
  <link rel="icon" href="https://i.imgur.com/CCC34mn.png">

  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <!-- Votre CSS personnalisé -->
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="loader/loader.css" />

  <style>
  /* ========= Variables ========= */
  :root{
    --bg1: linear-gradient(180deg, #162532 0%, #162532);
    --glass-bg: rgba(255,255,255,0.04);
    --glass-border: rgba(255, 255, 255, 0.1);
    --accent: #8EB1CD;
    --muted: rgba(255,255,255,0.65);
    --danger: rgba(179,0,0,0.9);
    --card-radius: 14px;
    --max-width: 1100px;
  }

  /* ========== Reset & base ========== */
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    font-family: 'Poppins', system-ui, -apple-system, 'Satoshi', 'Helvetica Neue', Arial;
    background: var(--bg1);
    color: #fff;
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
    line-height:1.45;
  }

  .page-wrap{
    min-height:100vh;
    display:flex;
    align-items:center;
    justify-content:center;
    padding:40px 20px;
    background-image: radial-gradient(rgba(255,255,255,0.02) 1px, transparent 1px);
    background-size: 120px 120px;
  }

  .frame{
    width:100%;
    max-width:var(--max-width);
    display:grid;
    grid-template-columns: 360px 1fr;
    gap:28px;
    align-items:start;
  }

  @media (max-width:880px){
    .frame{grid-template-columns:1fr; padding:12px}
  }

  .glass{
    background: linear-gradient(135deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));
    border: 1px solid var(--glass-border);
    border-radius: var(--card-radius);
    padding:18px;
    backdrop-filter: blur(8px) saturate(120%);
    -webkit-backdrop-filter: blur(8px) saturate(120%);
    box-shadow: 0 8px 30px rgba(2,6,23,0.6);
  }

  .profile-card{display:flex;flex-direction:column;gap:16px}
  .brand{display:flex;align-items:center;gap:12px}
  .brand img{width:44px;height:44px;border-radius:9px;object-fit:cover}
  .brand h1{font-size:18px;margin:0;font-weight:700;letter-spacing:0.4px}
  .brand p{margin:0;font-size:12px;color:var(--muted)}

  .avatar{width:84px;height:84px;border-radius:18px;overflow:hidden;border:1px solid rgba(255,255,255,0.08);display:flex;align-items:center;justify-content:center;font-weight:700;font-size:22px;background:linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));}

  .profile-top{display:flex;gap:14px;align-items:center}
  .profile-name{font-size:18px;font-weight:700}
  .profile-email{font-size:13px;color:var(--muted)}
  .small-btn{background:transparent;border:1px solid rgba(255,255,255,0.06);padding:8px 12px;border-radius:10px;font-weight:600;color:var(--accent);cursor:pointer}

  .loyalty{display:flex;gap:12px;align-items:center;justify-content:space-between;padding:14px;border-radius:12px;border:1px solid rgba(255,255,255,0.03);}
  .points{font-weight:700;font-size:20px}
  .progress-outer{flex:1;margin-left:12px}
  .progress-bar{height:8px;background:rgba(255,255,255,0.06);border-radius:999px;overflow:hidden}
  .progress-bar > i{display:block;height:100%;width:48%;background:linear-gradient(90deg,var(--accent), #7fb0c2);border-radius:999px}
  .markers{display:flex;justify-content:space-between;font-size:12px;color:var(--muted);margin-top:8px}

  .content{display:flex;flex-direction:column;gap:18px}

  .tabs{display:flex;gap:10px;flex-wrap:wrap}
  .tab-btn{padding:10px 14px;border-radius:10px;border:1px solid transparent;background:transparent;color:var(--muted);cursor:pointer;font-weight:600}
  .tab-btn[aria-selected="true"]{background:linear-gradient(90deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));color:var(--accent);border-color:rgba(144,190,214,0.12)}

  .panel{margin-top:6px}
  .card{background:transparent;padding:18px;border-radius:12px;border:1px solid rgba(255,255,255,0.03)}

  label{display:block;font-size:13px;color:var(--muted);margin-bottom:8px}
  input,select{width:100%;padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.06);background:rgba(255,255,255,0.02);color:#fff;font-size:15px}
  input:focus{outline:none;box-shadow:0 6px 18px rgba(0,0,0,0.6);border-color:var(--accent)}

  .row{display:flex;gap:12px}
  .col{flex:1}
  @media (max-width:520px){.row{flex-direction:column}}

  .controls{display:flex;gap:12px;flex-wrap:wrap}
  .controls .btn{padding:10px 14px;border-radius:10px;border: none;background:var(--accent);color:#071016;font-weight:700;cursor:pointer}
  .btn.ghost{background:#ffffff00;border:1px solid rgba(255, 255, 255, 0.06);border-radius:7px;color:var(--muted)}

  .fav-list{display:grid;gap:10px}
  .fav-item{display:flex;align-items:center;gap:12px;padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.03)}
  .fav-thumb{width:58px;height:58px;border-radius:8px;overflow:hidden;background:rgba(255,255,255,0.02);display:flex;align-items:center;justify-content:center}

  .meta{font-size:12px;color:var(--muted);text-align:center;margin-top:6px}
  .muted{color:var(--muted)}
  .flex{display:flex;gap:8px;align-items:center}

  .tab-content{margin-top:12px}

  /* AUTH MODAL */
  .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:linear-gradient(rgb(22, 37, 50), rgb(22, 37, 50));z-index:9999}
  .modal.active{display:flex}
  .modal-card{width:420px;max-width:94%;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border:1px solid rgba(255, 255, 255, 0.06);padding:18px}
  .auth-tabs{display:flex;gap:8px;margin-bottom:12px}
  .auth-tab{flex:1;padding:10px;border-radius:10px;background:transparent;border:1px solid transparent;color:var(--muted);text-align:center;cursor:pointer}
  .auth-tab.active{background:rgba(255,255,255,0.02);color:var(--accent);border-color:rgba(144,190,214,0.12);font-weight:700}
  .modal-card input{margin-bottom:10px}
  .alert{padding:10px;border-radius:8px;background:rgba(179,0,0,0.12);color:#d33333;margin-bottom:12px}
  .success{padding:10px;border-radius:8px;background:rgba(24,128,64,0.12);color:#2ebd60;margin-bottom:12px}

  .link-btn{background:none;border:none;color:var(--muted);text-decoration:underline;cursor:pointer;padding:0}

  .birthday-note{font-size:13px;color:var(--muted);margin-top:6px}
  .birthday-locked{color:var(--danger);font-size:13px;margin-top:6px}

  /* small helpers */
  .hidden{display:none}
  .center{text-align:center}
  </style>
</head>
<body>
    <!-- Loader -->
<div id="loader">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 2074 2156">
    <path d="M 417.5,100.5 C 470.965,97.4829 516.965,114.316 555.5,151C 572.882,168.613 587.715,188.113 600,209.5C 699.607,395.043 797.941,581.376 895,768.5C 896.809,771.964 898.976,775.131 901.5,778C 902.833,778.667 904.167,778.667 905.5,778C 921.468,763.7 937.135,749.033 952.5,734C 1024.11,660.389 1096.44,587.389 1169.5,515C 1187.47,498.699 1205.14,482.033 1222.5,465C 1253.04,436.778 1285.04,410.445 1318.5,386C 1332.32,376.868 1346.65,368.535 1361.5,361C 1373.5,354.933 1386.16,352.6 1399.5,354C 1413.48,358.322 1421.31,367.822 1423,382.5C 1424.51,395.129 1424.85,407.795 1424,420.5C 1418.78,455.511 1413.44,490.511 1408,525.5C 1387.05,694.451 1383.39,863.784 1397,1033.5C 1396.8,1040.51 1398.14,1047.18 1401,1053.5C 1405.79,1059.1 1411.63,1060.6 1418.5,1058C 1523.49,999.169 1630.83,944.502 1740.5,894C 1780.63,875.843 1821.63,859.843 1863.5,846C 1876.97,841.881 1890.64,838.548 1904.5,836C 1917.27,833.672 1929.94,834.005 1942.5,837C 1950.28,842.339 1952.44,849.506 1949,858.5C 1946.92,862.336 1944.58,866.003 1942,869.5C 1747.67,1115.83 1553.33,1362.17 1359,1608.5C 1356.94,1610.9 1355.27,1613.57 1354,1616.5C 1353.35,1620.88 1354.85,1624.38 1358.5,1627C 1387.5,1636.83 1414.17,1650.83 1438.5,1669C 1462.35,1687.51 1478.18,1711.35 1486,1740.5C 1492.81,1774.09 1482.64,1801.25 1455.5,1822C 1374.5,1875.83 1293.5,1929.67 1212.5,1983.5C 1167.6,1932.73 1111.27,1910.23 1043.5,1916C 1012.7,1922.36 982.029,1929.36 951.5,1937C 948.007,1938 944.841,1937.5 942,1935.5C 941.667,1904.83 941.333,1874.17 941,1843.5C 935.215,1801.08 913.715,1769.58 876.5,1749C 811.627,1709.14 742.627,1678.14 669.5,1656C 550.305,1620.52 428.639,1598.52 304.5,1590C 247.57,1585.36 190.57,1583.52 133.5,1584.5C 130.426,1584.55 128.259,1583.22 127,1580.5C 125.446,1562.2 124.446,1543.86 124,1525.5C 123.195,1225.98 138.862,927.316 171,629.5C 179.801,546.757 191.468,464.423 206,382.5C 213.83,338.346 224.83,295.013 239,252.5C 258.921,201.263 291.421,160.096 336.5,129C 361.518,113.607 388.518,104.107 417.5,100.5 Z M 452.5,798.5 C 454.722,798.178 456.556,798.845 458,800.5C 459.667,803.833 461.333,807.167 463,810.5C 473.299,843.434 486.633,875.1 503,905.5C 540.05,970.959 582.05,1032.96 629,1091.5C 646.289,1113.12 663.956,1134.46 682,1155.5C 688.703,1163.2 695.703,1170.53 703,1177.5C 821.169,1119.88 922.169,1040.21 1006,938.5C 1023.52,915.469 1041.52,892.802 1060,870.5C 1063.55,867.281 1067.39,864.448 1071.5,862C 1076.12,860.703 1079.95,861.87 1083,865.5C 1088.36,878.959 1091.36,892.959 1092,907.5C 1094.23,939.958 1095.4,972.458 1095.5,1005C 1093.75,1120.96 1089.25,1236.8 1082,1352.5C 1147.59,1305.26 1216.76,1263.43 1289.5,1227C 1317.9,1213.09 1347.56,1202.76 1378.5,1196C 1394.94,1192.34 1411.27,1192.67 1427.5,1197C 1440.47,1201.47 1448.81,1210.31 1452.5,1223.5C 1356.85,1326.32 1261.02,1428.98 1165,1531.5C 1058.3,1451.44 938.469,1401.94 805.5,1383C 750.108,1375.25 694.442,1371.42 638.5,1371.5C 592.507,1372.91 546.507,1373.41 500.5,1373C 490.312,1372.7 480.646,1370.36 471.5,1366C 469.622,1364.46 468.122,1362.62 467,1360.5C 463.645,1349.72 461.311,1338.72 460,1327.5C 452.49,1263.37 447.49,1199.03 445,1134.5C 441.096,1055.21 439.763,975.876 441,896.5C 441.187,867.647 443.521,838.98 448,810.5C 448.817,806.211 450.317,802.211 452.5,798.5 Z"/>
  </svg>
</div>

<!-- Header -->
<header class="header">
  <!-- Logo -->
  <a href="index.html" class="logo-link">
    <img src="https://i.imgur.com/Kl9kTBg.png" alt="Burban Logo" class="logo-img">
  </a>

  <!-- Nav desktop -->
  <nav class="nav">
    <a href="https://burbanofficial.com/index.html" class="nav-item">Home</a>
    <a href="https://burbanofficial.com/shop.html" class="nav-item">Shop</a>
    <a href="https://burbanofficial.com/about-burban.html" class="nav-item">About Burban</a>
    <a href="https://burbanofficial.com/contact.html" class="nav-item">Contact Us</a>
  </nav>

  <!-- Icônes + hamburger -->
  <div class="actions">
    <a href="https://burbanofficial.com/account.html" class="account-btn" aria-label="Mon compte"><i class="fa-solid fa-user"></i></a>&nbsp;&nbsp;&nbsp;&nbsp;
    <a href="https://burbanofficial.com/public/index.html" class="cart-btn" aria-label="Mon panier"><i class="fa-solid fa-bag-shopping"></i></a>&nbsp;&nbsp;&nbsp;&nbsp;
    <button class="hamburger" aria-label="Ouvrir le menu">
      <span class="bar"></span>
      <span class="bar"></span>
      <span class="bar"></span>
    </button>
    <!-- <div class="lang-switcher desktop-lang">
      <select id="languageSelector" aria-label="Changer de langue">
        <option value="EN">EN</option>
        <option value="FR">FR</option>
      </select>
    </div> -->
  </div>
</header>

<!-- Overlay menu mobile -->
<div class="overlay-menu" id="overlayMenu">
  <button class="close-btn" aria-label="Fermer le menu">&times;</button>
  <ul class="overlay-nav">
    <li><a href="https://burbanofficial.com/index.html">Home</a></li>
    <li><a href="https://burbanofficial.com/shop.html">Shop</a></li>
    <li><a href="https://burbanofficial.com/about-burban.html">About Burban</a></li>
    <li><a href="https://burbanofficial.com/contact.html">Contact Us</a></li>
    <!-- <li class="mobile-lang">
      <label for="languageSelectorMobile">Language:</label>
      <select id="languageSelectorMobile" aria-label="Changer de langue">
        <option value="EN">EN</option>
        <option value="FR">FR</option>
      </select>
    </li> -->
  </ul>
</div>

  <div class="page-wrap">
    <main id="mainFrame" class="frame" role="main" aria-label="Espace client Burban">

      <!-- LEFT column: profile summary -->
      <aside class="glass profile-card" aria-labelledby="profile-heading">
        <div class="brand">
          <img src="https://i.imgur.com/CCC34mn.png" alt="Burban">
          <div>
            <h1 id="profile-heading">Burban</h1>
            <p>Official customer area</p>
          </div>
        </div>

        <div class="profile-top">
          <div class="avatar" id="avatar">RC</div>
          <div>
            <div class="profile-name" id="userName">Guest</div>
            <div class="profile-email" id="userEmail">—</div>
            <div class="flex" style="margin-top:8px">
              <button class="small-btn" id="openAuth">Sign in / Sign up</button>
              <button class="small-btn hidden" id="logoutSmall">Sign out</button>
            </div>
          </div>
        </div>

        <div class="loyalty">
          <div>
            <div class="muted">Points</div>
            <div class="points" id="points">0</div>
          </div>
          <div class="progress-outer">
            <div class="progress-bar" aria-hidden="true"><i id="progressFill" style="width:0%"></i></div>
            <div class="markers">
              <span>0</span><span>500</span><span>1000</span><span>2500</span>
            </div>
          </div>
        </div>

        <div class="card" style="display:flex;flex-direction:column;gap:8px">
          <div class="muted">Quick actions</div>
          <div class="controls">
            <button class="btn" id="toOrders">My orders</button>
            <button class="btn" id="toFav">Favorites</button>
            <button class="btn" id="toSupport">Support</button>
          </div>
        </div>

        <div class="meta">Account created • <span id="createdAt">—</span></div>
      </aside>

      <!-- RIGHT column: content panels -->
      <section class="content">

        <div class="glass">
          <nav class="tabs" role="tablist" aria-label="Espace client onglets">
            <button class="tab-btn" role="tab" aria-selected="true" data-panel="profile">Profile</button>
            <button class="tab-btn" role="tab" aria-selected="false" data-panel="security">Security</button>
            <!-- <button class="tab-btn" role="tab" aria-selected="false" data-panel="favorites">Favorites</button> -->
            <button class="tab-btn" role="tab" aria-selected="false" data-panel="loyalty">My benefits</button>
            <!-- <button class="tab-btn" role="tab" aria-selected="false" data-panel="settings">Preferences</button> -->
          </nav>

          <div class="panel" id="panels">

            <!-- PROFILE PANEL -->
            <div class="card" id="profile" role="tabpanel">
              <h3 style="margin:0 0 8px">Profile</h3>
              <form id="profileForm" onsubmit="return false;">
                <div class="row">
                  <div class="col">
                    <label for="firstname">Firstname</label>
                    <input id="firstname" placeholder="Rémy" />
                  </div>
                  <div class="col">
                    <label for="lastname">Lastname</label>
                    <input id="lastname" placeholder="Cormon" />
                  </div>
                </div>
                <div style="margin-top:12px">
                  <label for="emailDisplay">Email</label>
                  <input id="emailDisplay" type="email" disabled />
                </div>
                <div style="margin-top:12px">
                  <label for="phone">Phone (optional)</label>
                  <input id="phone" placeholder="+33 6 12 34 56 78" />
                </div>

                <!-- Birthday field: editable only if not set -->
                <div style="margin-top:12px">
                  <label for="profileBirthday">Date of birth (optional)</label>
                  <input id="profileBirthday" type="date" />
                  <div id="birthdayNote" class="birthday-note">Add your date of birth to receive a surprise on your special day.</div>
                </div>

                <div style="margin-top:12px;display:flex;gap:10px;align-items:center">
                  <button class="btn" id="saveProfile">Save changes</button>
                  <button class="btn ghost" id="downloadData">Download data</button>
                </div>
              </form>
            </div>

            <!-- SECURITY PANEL -->
            <div class="card" id="security" role="tabpanel" hidden>
              <h3 style="margin:0 0 8px">Security</h3>
              <form id="passwordForm" onsubmit="return false;">
                <label for="newPass">New password</label>
                <input id="newPass" type="password" autocomplete="new-password" />
                <label for="confirmPass">Confirm password</label>
                <input id="confirmPass" type="password" autocomplete="new-password" />
                <div style="margin-top:12px;display:flex;gap:10px">
                  <button class="btn" id="updatePassword">Update password</button>
                  <button class="btn ghost" id="resetPasswordBtn">Reset password (email)</button>
                </div>
              </form>
            </div>

            <!-- FAVORITES PANEL -->
            <div class="card" id="favorites" role="tabpanel" hidden>
              <h3 style="margin:0 0 8px">Favorites</h3>
              <div class="fav-list" id="favList"></div>
              <div style="margin-top:12px"><button class="btn ghost" id="clearFav">Clear favorites</button></div>
            </div>

            <!-- LOYALTY PANEL -->
            <div class="card" id="loyalty" role="tabpanel" hidden>
              <h3 style="margin:0 0 8px">My Burban Benefits</h3>
              <p class="muted">Points convert to rewards. €1 = 10 pts.</p>
              <div style="display:flex;gap:18px;align-items:center;margin-top:12px;flex-wrap:wrap">
                <div style="min-width:120px;text-align:center">
                  <div style="font-size:26px;font-weight:800" id="coins">0</div>
                  <div class="muted">Coins</div>
                </div>
                <div style="flex:1">
                  <div class="progress-bar" aria-hidden><i id="loyaltyFill" style="width:0%"></i></div>
                  <div class="markers">
                    <span>0€</span><span>5€</span><span>10€</span><span>20€</span><span>30€</span>
                  </div>
                </div>
              </div>
              <div style="margin-top:14px" class="muted" id="nextReward">Next reward at 500 pts</div>
            </div>

            <!-- SETTINGS PANEL -->
            <div class="card" id="settings" role="tabpanel" hidden>
              <h3 style="margin:0 0 8px">Preferences</h3>
              <label for="lang">Language</label>
              <select id="lang"><option>FR</option><option>EN</option></select>
              <label style="margin-top:12px">Email preferences</label>
              <div style="display:flex;gap:8px;margin-top:8px;flex-wrap:wrap">
                <button class="small-btn" aria-pressed="false">Newsletter</button>
                <button class="small-btn" aria-pressed="true">Order updates</button>
                <button class="small-btn" aria-pressed="false">Marketing</button>
              </div>
              <div style="margin-top:14px"><button class="btn ghost" id="deleteAccount">Delete account</button></div>
            </div>

          </div>
        </div>

        <div class="meta">© Burban. All Rights Reserved</div>

      </section>

    </main>
  </div>

  <!-- AUTH MODAL -->
  <div class="modal" id="authModal" aria-hidden="true">
    <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="authTitle">
      <div class="auth-tabs">
        <div class="auth-tab active" data-mode="login">Log in</div>
        <div class="auth-tab" data-mode="register">Sign up</div>
      </div>

      <div id="authMessages"></div>

      <div id="loginForm">
        <input id="loginEmail" type="email" placeholder="Email address" />
        <input id="loginPassword" type="password" placeholder="Password" />
        <div style="display:flex;gap:8px;margin-top:8px">
          <button class="btn" id="btnLogin">Log in</button>
          <button class="btn ghost" id="forgotBtn">Forgot?</button>
        </div>
      </div>

      <div id="registerForm" class="hidden">
        <input id="regFirstname" placeholder="Firstname" />
        <input id="regLastname" placeholder="Lastname" />
        <input id="regEmail" type="email" placeholder="Email address" />
        <input id="regPassword" type="password" placeholder="Password (min 6)" />
        <label for="regBirthday" style="font-size:12px;color:var(--muted);margin-top:6px">Date of birth (optional — used for birthday surprise purposes)</label>
        <input id="regBirthday" type="date" />
        <div style="display:flex;gap:8px;margin-top:8px">
          <button class="btn" id="btnRegister">Create account</button>
          <button class="btn ghost" id="btnCloseAuth">Close</button>
        </div>
      </div>

      <div class="center" style="margin-top:12px;font-size:12px;color:var(--muted)">
        By creating an account you accept our <button class="link-btn">Terms</button> and <button class="link-btn">Privacy</button>.
      </div>
    </div>
  </div>

  <!-- Firebase (compat) -->
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>

  <script>
  // -------------------- CONFIG --------------------
  const firebaseConfig = {
    apiKey: "AIzaSyDb4AOtRT7jGENnLZ2KNwpczaG2Z77G2rc",
    authDomain: "burban-fidelity.firebaseapp.com",
    projectId: "burban-fidelity",
    storageBucket: "burban-fidelity.firebasestorage.app",
    messagingSenderId: "830299174800",
    appId: "1:830299174800:web:f50a4ec419e108f7f16515",
    measurementId: "G-E4QD4PYLM5"
  };

  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();

  // -------------------- UI refs --------------------
  const authModal = document.getElementById('authModal');
  const openAuth = document.getElementById('openAuth');
  const logoutSmall = document.getElementById('logoutSmall');
  const btnLogin = document.getElementById('btnLogin');
  const btnRegister = document.getElementById('btnRegister');
  const authMessages = document.getElementById('authMessages');
  const mainFrame = document.getElementById('mainFrame');

  // profile refs
  const userName = document.getElementById('userName');
  const userEmail = document.getElementById('userEmail');
  const avatar = document.getElementById('avatar');
  const pointsEl = document.getElementById('points');
  const progressFill = document.getElementById('progressFill');
  const coins = document.getElementById('coins');
  const loyaltyFill = document.getElementById('loyaltyFill');
  const createdAt = document.getElementById('createdAt');

  // forms
  const loginEmail = document.getElementById('loginEmail');
  const loginPassword = document.getElementById('loginPassword');
  const regFirstname = document.getElementById('regFirstname');
  const regLastname = document.getElementById('regLastname');
  const regEmail = document.getElementById('regEmail');
  const regPassword = document.getElementById('regPassword');
  const regBirthday = document.getElementById('regBirthday');

  const firstnameInput = document.getElementById('firstname');
  const lastnameInput = document.getElementById('lastname');
  const emailDisplay = document.getElementById('emailDisplay');
  const phoneInput = document.getElementById('phone');
  const saveProfile = document.getElementById('saveProfile');
  const downloadData = document.getElementById('downloadData');
  const favList = document.getElementById('favList');
  const clearFav = document.getElementById('clearFav');
  const resetPasswordBtn = document.getElementById('resetPasswordBtn');
  const updatePassword = document.getElementById('updatePassword');
  const profileBirthday = document.getElementById('profileBirthday');
  const birthdayNote = document.getElementById('birthdayNote');

  // tabs
  const tabBtns = document.querySelectorAll('.tab-btn');
  const panels = document.querySelectorAll('[role="tabpanel"]');

  // auth tabs inside modal
  document.querySelectorAll('.auth-tab').forEach(tab => {
    tab.addEventListener('click', () => {
      document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
      tab.classList.add('active');
      const mode = tab.dataset.mode;
      document.getElementById('loginForm').classList.toggle('hidden', mode!=='login');
      document.getElementById('registerForm').classList.toggle('hidden', mode!=='register');
      authMessages.innerHTML = '';
    });
  });

  // open modal
  openAuth.addEventListener('click', () => { authModal.classList.add('active'); authModal.setAttribute('aria-hidden','false'); });
  document.getElementById('btnCloseAuth').addEventListener('click', ()=>{
    // only allow closing if user is authenticated
    if(auth.currentUser){ authModal.classList.remove('active'); authModal.setAttribute('aria-hidden','true'); }
    else{ showMessage('Please sign in to continue.'); }
  });

  // close modal on backdrop click: only if user authenticated
  authModal.addEventListener('click', (e)=>{ if(e.target===authModal && auth.currentUser){ authModal.classList.remove('active'); authModal.setAttribute('aria-hidden','true'); }});

  // lightweight tabs
  function setActive(panelId, btn){ panels.forEach(p=> p.hidden = (p.id !== panelId)); tabBtns.forEach(t=> t.setAttribute('aria-selected', t===btn ? 'true' : 'false')); }
  tabBtns.forEach(btn => { btn.addEventListener('click', ()=> setActive(btn.dataset.panel, btn)); });
  setActive('profile', document.querySelector('.tab-btn'));

  // -------------------- Helpers --------------------
  function showMessage(html, success=false){ authMessages.innerHTML = `<div class="${success? 'success':'alert'}">${html}</div>`; }
  function clearMessage(){ authMessages.innerHTML=''; }
  function setAvatarInitials(name){ const parts = (name||'').split(' '); const initials = (parts[0]||'').charAt(0) + ((parts[1]||'').charAt(0)||''); avatar.textContent = (initials||'G').toUpperCase(); }

  // -------------------- Auth actions --------------------
  btnRegister.addEventListener('click', async ()=>{
    clearMessage();
    const first = regFirstname.value.trim();
    const last = regLastname.value.trim();
    const email = regEmail.value.trim();
    const pass = regPassword.value;
    const birthday = regBirthday.value || '';
    if(!first || !last || !email || pass.length < 6){ showMessage('Please fill all fields and use a password of at least 6 characters.'); return; }
    try{
      const cred = await auth.createUserWithEmailAndPassword(email, pass);
      await cred.user.sendEmailVerification();
      // create user doc
      await db.collection('users').doc(cred.user.uid).set({
        firstname: first,
        lastname: last,
        email,
        phone: '',
        birthday: birthday,
        newsletter: false,
        favorites: [],
        points: 0,
        createdAt: firebase.firestore.FieldValue.serverTimestamp()
      });
      showMessage('Account created. Verification email sent. Please verify before logging in.', true);
      // switch to login tab
      document.querySelector('.auth-tab[data-mode="login"]').click();
    }catch(err){ console.error(err); showMessage(err.message || 'Registration error'); }
  });

  btnLogin.addEventListener('click', async ()=>{
    clearMessage();
    const email = loginEmail.value.trim();
    const pass = loginPassword.value;
    if(!email || !pass){ showMessage('Please enter email and password.'); return; }
    try{
      const cred = await auth.signInWithEmailAndPassword(email, pass);
      if(!cred.user.emailVerified){ await auth.signOut(); showMessage('Please verify your email before logging in.'); return; }
      // modal will be closed by onAuthStateChanged
      clearMessage();
    }catch(err){ console.error(err); showMessage(err.message || 'Login error'); }
  });

  // forgot password
  document.getElementById('forgotBtn').addEventListener('click', async ()=>{
    const email = loginEmail.value.trim() || prompt('Please enter your email for password reset:');
    if(!email) return;
    try{ await auth.sendPasswordResetEmail(email); showMessage('Password reset email sent.', true); }catch(err){ showMessage(err.message); }
  });

  // sign out
  logoutSmall.addEventListener('click', async ()=>{
    await auth.signOut();
    // onAuthStateChanged will re-open auth modal
  });

  // -------------------- Auth state handling: gate logic --------------------
  // Ensure the auth modal is shown before content when not authenticated
  // Start by locking UI until we know the state
  (function lockUI(){ mainFrame.style.pointerEvents='none'; mainFrame.style.opacity='0.55'; authModal.classList.add('active'); authModal.setAttribute('aria-hidden','false'); })();

  auth.onAuthStateChanged(async (user) => {
    if(user){
      // require verified
      if(!user.emailVerified){ showMessage('Please verify your email.'); await auth.signOut(); return; }
      // hide auth modal and unlock main
      authModal.classList.remove('active'); authModal.setAttribute('aria-hidden','true');
      mainFrame.style.pointerEvents='auto'; mainFrame.style.opacity='1';

      openAuth.classList.add('hidden'); logoutSmall.classList.remove('hidden');
      // load profile
      loadUserProfile(user);
      loadUserFavorites(user);
      loadUserAdvantages(user);
    }else{
      // no user: show modal and lock main
      authModal.classList.add('active'); authModal.setAttribute('aria-hidden','false');
      mainFrame.style.pointerEvents='none'; mainFrame.style.opacity='0.55';
      openAuth.classList.remove('hidden'); logoutSmall.classList.add('hidden');
      // clear UI
      userName.textContent = 'Guest'; userEmail.textContent = '—'; setAvatarInitials('Guest'); pointsEl.textContent='0'; progressFill.style.width='0%'; coins.textContent='0'; loyaltyFill.style.width='0%'; createdAt.textContent='—'; favList.innerHTML='';
    }
  });

  // -------------------- Loaders --------------------
  async function loadUserProfile(user){
    try{
      const doc = await db.collection('users').doc(user.uid).get();
      if(doc.exists){
        const data = doc.data();
        userName.textContent = `${data.firstname || ''} ${data.lastname || ''}`.trim() || user.email;
        userEmail.textContent = data.email || user.email;
        setAvatarInitials(data.firstname + ' ' + data.lastname);
        firstnameInput.value = data.firstname || '';
        lastnameInput.value = data.lastname || '';
        emailDisplay.value = data.email || user.email;
        phoneInput.value = data.phone || '';

        // Birthday logic: if a birthday exists -> lock the field and show support note
        if(data.birthday){
          profileBirthday.value = data.birthday;
          profileBirthday.disabled = true;
          birthdayNote.className = 'birthday-locked';
          birthdayNote.innerHTML = 'Date of birth recorded. To modify it, contact the support (identity verification required).';
        } else {
          profileBirthday.value = '';
          profileBirthday.disabled = false;
          birthdayNote.className = 'birthday-note';
          birthdayNote.textContent = 'Add your date of birth to receive a surprise on your special day.';
        }

        if(data.createdAt && data.createdAt.toDate) createdAt.textContent = data.createdAt.toDate().toLocaleDateString();
      }else{
        // fallback to basic info
        userName.textContent = user.email.split('@')[0]; userEmail.textContent = user.email; setAvatarInitials(user.email);
        profileBirthday.value = '';
        profileBirthday.disabled = false;
        birthdayNote.className = 'birthday-note';
        birthdayNote.textContent = 'Add your date of birth to receive a surprise on your special day.';
      }
    }catch(err){console.error(err)}
  }

  async function loadUserFavorites(user){
    try{
      const doc = await db.collection('users').doc(user.uid).get();
      const data = (doc.exists && doc.data()) || {};
      const favorites = data.favorites || [];
      favList.innerHTML = '';
      if(favorites.length===0){ favList.innerHTML = '<div class="muted">No favorites yet</div>'; }
      else{
        favorites.forEach(f => {
          const el = document.createElement('div'); el.className='fav-item'; el.innerHTML = `<div class="fav-thumb">IMG</div><div style="flex:1">${f}</div><div class="muted">—</div>`; favList.appendChild(el);
        });
      }
    }catch(err){console.error(err)}
  }

async function loadUserAdvantages(user){
try{
const doc = await db.collection('users').doc(user.uid).get();
const pts = (doc.exists && doc.data().points) || 0;
pointsEl.textContent = pts;

// progress relative to the maximum defined tier (2500 pts -> 30€)
const percent = Math.min(100, Math.round((pts / 2500) * 100));
progressFill.style.width = percent + '%';
coins.textContent = pts;
loyaltyFill.style.width = percent + '%';

// Paliers de récompense (pts -> libellé)
const thresholds = [
{ pts: 500, label: '5€' },
{ pts: 1000, label: '10€' },
{ pts: 2000, label: '20€' },
{ pts: 2500, label: '30€' }
];

// Cherche le prochain palier supérieur aux points actuels
const upcoming = thresholds.find(t => pts < t.pts);
if (upcoming) {
const missing = upcoming.pts - pts;
document.getElementById('nextReward').textContent = `Prochaine récompense : ${upcoming.label} — il vous manque ${missing} pts`;
} else {
document.getElementById('nextReward').textContent = 'Félicitations — vous avez atteint le meilleur palier (30€) !';
}
}catch(err){console.error(err)}
}

  // -------------------- Profile update --------------------
  saveProfile.addEventListener('click', async ()=>{
    const user = auth.currentUser; if(!user){ alert('Please sign in first'); return; }
    const newFirst = firstnameInput.value.trim(); const newLast = lastnameInput.value.trim(); const newPhone = phoneInput.value.trim();
    const newBirthday = profileBirthday.value;
    try{
      const updates = { firstname: newFirst, lastname: newLast, phone: newPhone };
      // Only set birthday if the field is enabled (meaning user had none before) and a value was provided
      if(!profileBirthday.disabled && newBirthday){ updates.birthday = newBirthday; }

      await db.collection('users').doc(user.uid).update(updates);

      userName.textContent = `${newFirst} ${newLast}`.trim(); setAvatarInitials(newFirst + ' ' + newLast);

      // If we just added a birthday, lock the field and change note
      if(updates.birthday){
        profileBirthday.disabled = true;
        birthdayNote.className = 'birthday-locked';
        birthdayNote.innerHTML = 'Date de naissance enregistrée. Pour la modifier, contactez <a href="mailto:support@burbanofficial.com">support@burbanofficial.com</a> (vérification d\'identité requise).';
      }

      alert('Profile updated');
    }catch(err){ console.error(err); alert('Error: '+err.message); }
  });

  // download user data (CSV)
  downloadData.addEventListener('click', async ()=>{
    const user = auth.currentUser; if(!user){ alert('Please sign in first'); return; }
    const doc = await db.collection('users').doc(user.uid).get();
    const data = doc.exists ? doc.data() : {};
    const csvRows = [ ['field','value'] ];
    for(const k in data){ csvRows.push([k, JSON.stringify(data[k])]); }
    const csv = csvRows.map(r=> r.map(c=> '"'+String(c).replace(/"/g,'""')+'"').join(',')).join('\n');
    const blob = new Blob([csv], { type: 'text/csv' });
    const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href = url; a.download = 'burban_user_data.csv'; a.click(); URL.revokeObjectURL(url);
  });

  // -------------------- Favorites management --------------------
  clearFav.addEventListener('click', async ()=>{
    const user = auth.currentUser; if(!user){ alert('Please sign in first'); return; }
    if(!confirm('Clear all favorites?')) return;
    try{ await db.collection('users').doc(user.uid).update({ favorites: [] }); loadUserFavorites(user); }catch(err){console.error(err)}
  });

  // -------------------- Password & reset --------------------
  updatePassword.addEventListener('click', async ()=>{
    const user = auth.currentUser; if(!user){ alert('Please sign in first'); return; }
    const newP = document.getElementById('newPass').value; const conf = document.getElementById('confirmPass').value;
    if(!newP || newP !== conf){ alert('Passwords must match'); return; }
    try{ await user.updatePassword(newP); alert('Password updated'); document.getElementById('passwordForm').reset(); }catch(err){ alert('Error: '+err.message); }
  });

  resetPasswordBtn.addEventListener('click', async ()=>{
    const email = auth.currentUser ? auth.currentUser.email : prompt('Enter your email to receive reset.') || '';
    if(!email) return; try{ await auth.sendPasswordResetEmail(email); alert('Reset email sent'); }catch(err){ alert(err.message); }
  });

  // -------------------- Delete account (UI-level) --------------------
  document.getElementById('deleteAccount').addEventListener('click', async ()=>{
    const user = auth.currentUser; if(!user) { alert('Sign in first'); return; }
    if(!confirm('Delete your account permanently? This action cannot be undone.')) return;
    try{
      // remove user doc then delete auth
      await db.collection('users').doc(user.uid).delete();
      await user.delete();
      alert('Account deleted');
    }catch(err){ alert('Error: '+err.message); }
  });

  // small route buttons
  // redirection document.getElementById('toFav').addEventListener('click', ()=> document.querySelector('[data-panel="favorites"]').click());
  document.getElementById('toFav').addEventListener('click', ()=> alert('Favorites view — coming soon'));
  document.getElementById('toSupport').addEventListener('click', ()=> alert('Contact: support@burbanofficial.com'));
  document.getElementById('toOrders').addEventListener('click', ()=> alert('Orders view — coming soon'));

  // quick demo: add favorite (for testing)
  function addFavoriteDemo(name){
    const user = auth.currentUser; if(!user){ alert('Sign in first'); return; }
    db.collection('users').doc(user.uid).update({ favorites: firebase.firestore.FieldValue.arrayUnion(name) }).then(()=> loadUserFavorites(user));
  }

  // expose for console debugging
  window.__burban = { auth, db, addFavoriteDemo };
  </script>
</body>
</html>
