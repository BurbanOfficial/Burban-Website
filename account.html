<!doctype html>
<html lang="en">
<head>
  <!-- Main META Tags -->
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="description" content="Burban Official Customers Area">
  <meta name="robots" content="index, follow">
  <meta name="keywords" content="Burban, streetwear, urban fashion, streetwear brand, hoodies, caps, t-shirts, beanies, trendy clothing, modern fashion, Burban official store, customer area">
  <meta name="author" content="Burban Official">

  <title>Burban — Customers Area</title>

  <!-- Open Graph (Facebook, WhatsApp, etc.) -->
  <meta property="og:type" content="website">
  <meta property="og:title" content="Burban | Official Streetwear Store">
  <meta property="og:description" content="Join the Burban movement. Unique streetwear pieces crafted for those who express themselves through style and creativity.">
  <meta property="og:url" content="https://www.burbanofficial.com/">
  <meta property="og:image" content="https://burbanofficial.com/favicon.png">

  <!-- Divers -->
  <link rel="canonical" href="https://www.burbanofficial.com/">

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Burban | Official Streetwear Store">
  <meta name="twitter:description" content="Discover bold, authentic streetwear. High-quality collections for those who define their own style. Join the Burban movement.">
  <meta name="twitter:image" content="https://burbanofficial.com/favicon.png">

  <link rel="stylesheet" href="https://burbanofficial.com/style.css" />
  <link rel="stylesheet" href="https://burbanofficial.com/loader/loader.css" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;700&display=swap" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">

  <!-- Fonts -->
  <link href="https://api.fontshare.com/v2/css?f[]=satoshi@400,600,700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;700&display=swap" rel="stylesheet">

  <!-- Favicon minimal -->
  <!-- Favicon -->
  <link rel="icon" href="https://burbanofficial.com/favicon.png" type="image/png">
  <link rel="apple-touch-icon" href="https://burbanofficial.com/favicon.png">
  <!-- Favicon pour les navigateurs modernes -->
  <link rel="icon" href="https://burbanofficial.com/favicon.png" sizes="16x16" />
  <link rel="icon" href="https://burbanofficial.com/favicon.png" sizes="32x32" />
  <link rel="icon" href="https://burbanofficial.com/favicon.png" sizes="48x48" />

  <style>
  /* ========= Variables ========= */
  :root{
    --bg1: linear-gradient(180deg, #162532 0%, #162532);
    --glass-bg: rgba(255,255,255,0.04);
    --glass-border: rgba(255, 255, 255, 0.1);
    --accent: #8EB1CD;
    --muted: rgba(255,255,255,0.65);
    --danger: rgba(179,0,0,0.9);
    --card-radius: 14px;
    --max-width: 1100px;
  }

  /* ========== Reset & base ========== */
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    font-family: 'Poppins', system-ui, -apple-system, 'Satoshi', 'Helvetica Neue', Arial;
    background: var(--bg1);
    color: #fff;
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
    line-height:1.45;
  }

  .page-wrap{
    min-height:100vh;
    display:flex;
    align-items:center;
    justify-content:center;
    padding:40px 20px;
    background-image: radial-gradient(rgba(255,255,255,0.02) 1px, transparent 1px);
    background-size: 120px 120px;
  }

  .frame{
    width:100%;
    max-width:var(--max-width);
    display:grid;
    grid-template-columns: 360px 1fr;
    gap:28px;
    align-items:start;
  }

  @media (max-width:880px){
    .frame{grid-template-columns:1fr; padding:12px}
  }

  .glass{
    background: linear-gradient(135deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));
    border: 1px solid var(--glass-border);
    border-radius: var(--card-radius);
    padding:18px;
    backdrop-filter: blur(8px) saturate(120%);
    -webkit-backdrop-filter: blur(8px) saturate(120%);
    box-shadow: 0 8px 30px rgba(2,6,23,0.6);
  }

  .profile-card{display:flex;flex-direction:column;gap:16px}
  .brand{display:flex;align-items:center;gap:12px}
  .brand img{width:44px;height:44px;border-radius:9px;object-fit:cover}
  .brand h1{font-size:18px;margin:0;font-weight:700;letter-spacing:0.4px}
  .brand p{margin:0;font-size:12px;color:var(--muted)}

  .avatar{width:84px;height:84px;border-radius:18px;overflow:hidden;border:1px solid rgba(255,255,255,0.08);display:flex;align-items:center;justify-content:center;font-weight:700;font-size:22px;background:linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));}

  .profile-top{display:flex;gap:14px;align-items:center}
  .profile-name{font-size:18px;font-weight:700}
  .profile-email{font-size:13px;color:var(--muted)}
  .small-btn{background:#b633d3ba;border:1px solid #ffffffba;padding:8px 12px;border-radius:10px;font-weight:600;color:#ffffffba;cursor:pointer;text-decoration:none;font-size:14px;}
  .small-btn:hover{background:transparent;border:1px dashed #b633d3ba;padding:8px 12px;border-radius:10px;font-weight:600;color:#b633d3ba;cursor:pointer}

  .loyalty{display:flex;gap:12px;align-items:center;justify-content:space-between;padding:14px;border-radius:12px;border:1px solid rgba(255,255,255,0.03);}
  .points{font-weight:700;font-size:20px}
  .progress-outer{flex:1;margin-left:12px}
  .progress-bar{height:8px;background:rgba(255,255,255,0.06);border-radius:999px;overflow:hidden}
  .progress-bar > i{display:block;height:100%;width:48%;background:linear-gradient(90deg,var(--accent), #7fb0c2);border-radius:999px}
  .markers{display:flex;justify-content:space-between;font-size:12px;color:var(--muted);margin-top:8px}

  .content{display:flex;flex-direction:column;gap:18px}

  .tabs{display:flex;gap:10px;flex-wrap:wrap}
  .tab-btn{padding:10px 14px;border-radius:10px;border:1px solid transparent;background:transparent;color:var(--muted);cursor:pointer;font-weight:600}
  .tab-btn[aria-selected="true"]{background:linear-gradient(90deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));color:var(--accent);border-color:rgba(144,190,214,0.12)}

  .panel{margin-top:6px}
  .card{background:transparent;padding:18px;border-radius:12px;border:1px solid rgba(255,255,255,0.03)}

  label{display:block;font-size:13px;color:var(--muted);margin-bottom:8px}
  input,select{width:100%;padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.06);background:rgba(255,255,255,0.02);color:#fff;font-size:15px}
  input:focus{outline:none;box-shadow:0 6px 18px rgba(0,0,0,0.6);border-color:var(--accent)}

  .row{display:flex;gap:12px}
  .col{flex:1}
  @media (max-width:520px){.row{flex-direction:column}}

  .controls{display:flex;gap:12px;flex-wrap:wrap}
  .controls .btn{padding:10px 14px;border-radius:10px;border:1px solid #8EB1CD;background:var(--accent);color:#071016;font-weight:700;cursor:pointer}
  .controls .btn:hover{padding:10px 14px;border-radius:10px;border:1px solid #ffffffba;background:var(--accent);color:#ffffff;font-weight:700;cursor:pointer}
  .btn.ghost{background:#ffffff00;border:1px solid rgba(255, 255, 255, 0.06);border-radius:7px;color:var(--muted)}
  .btn{padding:10px 14px;border-radius:10px;border:1px solid #8EB1CD;background:var(--accent);color:#071016;font-weight:700;cursor:pointer}
  .btn:hover{padding:10px 14px;border-radius:10px;border:1px solid #ffffffba;background:var(--accent);color:#ffffff;font-weight:700;cursor:pointer}
  .btn-delete{background:transparent;border:1px dashed #d33333ba;padding:8px 12px;border-radius:10px;font-weight:600;color:#d33333ba;cursor:pointer}
  .btn-delete:hover{background:#d33333ba;border:1px solid #ffffffba;padding:8px 12px;border-radius:10px;font-weight:600;color:#ffffffba;cursor:pointer}
  
  .fav-list{display:grid;gap:10px}
  .fav-item{display:flex;align-items:center;gap:12px;padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.03)}
  .fav-thumb{width:58px;height:58px;border-radius:8px;overflow:hidden;background:rgba(255,255,255,0.02);display:flex;align-items:center;justify-content:center}

  .meta{font-size:12px;color:var(--muted);text-align:center;margin-top:6px}
  .muted{color:var(--muted)}
  .flex{display:flex;gap:8px;align-items:center}

  .tab-content{margin-top:12px}

  /* AUTH MODAL */
  .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:linear-gradient(rgb(22, 37, 50), rgb(22, 37, 50));z-index:9999}
  .modal.active{display:flex}
  .modal-card{width:420px;max-width:94%;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border:1px solid rgba(255, 255, 255, 0.06);padding:18px}
  .auth-tabs{display:flex;gap:8px;margin-bottom:12px}
  .auth-tab{flex:1;padding:10px;border-radius:10px;background:transparent;border:1px solid transparent;color:var(--muted);text-align:center;cursor:pointer}
  .auth-tab.active{background:rgba(255,255,255,0.02);color:var(--accent);border-color:rgba(144,190,214,0.12);font-weight:700}
  .modal-card input{margin-bottom:10px}
  .alert{padding:10px;border-radius:8px;background:rgba(179,0,0,0.12);color:#d33333;margin-bottom:12px}
  .success{padding:10px;border-radius:8px;background:rgba(24,128,64,0.12);color:#2ebd60;margin-bottom:12px}

  .link-btn{background:none;border:none;color:var(--muted);text-decoration:underline;cursor:pointer;padding:0}

  .birthday-note{font-size:13px;color:var(--muted);margin-top:6px}
  .birthday-locked{color:var(--danger);font-size:13px;margin-top:6px}

  /* small helpers */
  .hidden{display:none}
  .center{text-align:center}

  /* Country select styled like input */
.country-select {
  -webkit-appearance: none;
  appearance: none;
  border-radius: 10px;
  margin-bottom: 10px;
  background: rgba(255,255,255,0.02);
  border: 1px solid rgba(255,255,255,0.06);
  color: #fff;
  width:100%;
  font-size:15px;
  cursor:pointer;
}

/* phone input small tweak */
.phone-input {
  font-variant-numeric: tabular-nums;
  letter-spacing: 0.6px;
}

/* Toggle switch (Apple-like pill) */
.toggle-switch {
  --w: 56px;
  --h: 32px;
  --knob: 26px;
  display:inline-grid;
  width:var(--w);
  height:var(--h);
  border-radius: 999px;
  padding: 3px;
  background: rgba(255,255,255,0.06);
  border: 1px solid rgba(255,255,255,0.06);
  position:relative;
  align-items:center;
  cursor:pointer;
  transition: background .22s ease, border-color .22s ease;
}
.toggle-switch .track { position:absolute; inset:0; border-radius:999px; }
.toggle-switch .knob {
  width:var(--knob); height:var(--knob); border-radius:50%;
  background:#fff; transform:translateX(0);
  box-shadow: 0 3px 10px rgba(2,6,23,0.6);
  transition: transform .22s cubic-bezier(.2,.9,.3,1);
  position:relative; z-index:2;
}

/* ON state (green) */
.toggle-switch.on { background: linear-gradient(90deg, rgba(46,189,96,0.18), rgba(46,189,96,0.08)); border-color: rgba(46,189,96,0.33); }
.toggle-switch.on .knob { transform: translateX(calc(var(--w) - var(--knob) - 6px)); }

/* OFF state (red) */
.toggle-switch.off { background: linear-gradient(90deg, rgba(220,80,80,0.12), rgba(220,80,80,0.04)); border-color: rgba(220,80,80,0.22); }
.toggle-switch.off .knob { transform: translateX(0); }

/* small focus style for accessibility */
.toggle-switch:focus { outline: 2px solid rgba(144,190,214,0.12); outline-offset:2px; }

#logoutSmall, #goShop {
  margin-right: 8px;
}
  </style>
</head>
<body>
  <script type="text/javascript" async="" src="https://static.klaviyo.com/onsite/js/Sg3qFU/klaviyo.js"></script>
  <!-- Loader -->
<div id="loader">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 2074 2156">
    <path d="M 417.5,100.5 C 470.965,97.4829 516.965,114.316 555.5,151C 572.882,168.613 587.715,188.113 600,209.5C 699.607,395.043 797.941,581.376 895,768.5C 896.809,771.964 898.976,775.131 901.5,778C 902.833,778.667 904.167,778.667 905.5,778C 921.468,763.7 937.135,749.033 952.5,734C 1024.11,660.389 1096.44,587.389 1169.5,515C 1187.47,498.699 1205.14,482.033 1222.5,465C 1253.04,436.778 1285.04,410.445 1318.5,386C 1332.32,376.868 1346.65,368.535 1361.5,361C 1373.5,354.933 1386.16,352.6 1399.5,354C 1413.48,358.322 1421.31,367.822 1423,382.5C 1424.51,395.129 1424.85,407.795 1424,420.5C 1418.78,455.511 1413.44,490.511 1408,525.5C 1387.05,694.451 1383.39,863.784 1397,1033.5C 1396.8,1040.51 1398.14,1047.18 1401,1053.5C 1405.79,1059.1 1411.63,1060.6 1418.5,1058C 1523.49,999.169 1630.83,944.502 1740.5,894C 1780.63,875.843 1821.63,859.843 1863.5,846C 1876.97,841.881 1890.64,838.548 1904.5,836C 1917.27,833.672 1929.94,834.005 1942.5,837C 1950.28,842.339 1952.44,849.506 1949,858.5C 1946.92,862.336 1944.58,866.003 1942,869.5C 1747.67,1115.83 1553.33,1362.17 1359,1608.5C 1356.94,1610.9 1355.27,1613.57 1354,1616.5C 1353.35,1620.88 1354.85,1624.38 1358.5,1627C 1387.5,1636.83 1414.17,1650.83 1438.5,1669C 1462.35,1687.51 1478.18,1711.35 1486,1740.5C 1492.81,1774.09 1482.64,1801.25 1455.5,1822C 1374.5,1875.83 1293.5,1929.67 1212.5,1983.5C 1167.6,1932.73 1111.27,1910.23 1043.5,1916C 1012.7,1922.36 982.029,1929.36 951.5,1937C 948.007,1938 944.841,1937.5 942,1935.5C 941.667,1904.83 941.333,1874.17 941,1843.5C 935.215,1801.08 913.715,1769.58 876.5,1749C 811.627,1709.14 742.627,1678.14 669.5,1656C 550.305,1620.52 428.639,1598.52 304.5,1590C 247.57,1585.36 190.57,1583.52 133.5,1584.5C 130.426,1584.55 128.259,1583.22 127,1580.5C 125.446,1562.2 124.446,1543.86 124,1525.5C 123.195,1225.98 138.862,927.316 171,629.5C 179.801,546.757 191.468,464.423 206,382.5C 213.83,338.346 224.83,295.013 239,252.5C 258.921,201.263 291.421,160.096 336.5,129C 361.518,113.607 388.518,104.107 417.5,100.5 Z M 452.5,798.5 C 454.722,798.178 456.556,798.845 458,800.5C 459.667,803.833 461.333,807.167 463,810.5C 473.299,843.434 486.633,875.1 503,905.5C 540.05,970.959 582.05,1032.96 629,1091.5C 646.289,1113.12 663.956,1134.46 682,1155.5C 688.703,1163.2 695.703,1170.53 703,1177.5C 821.169,1119.88 922.169,1040.21 1006,938.5C 1023.52,915.469 1041.52,892.802 1060,870.5C 1063.55,867.281 1067.39,864.448 1071.5,862C 1076.12,860.703 1079.95,861.87 1083,865.5C 1088.36,878.959 1091.36,892.959 1092,907.5C 1094.23,939.958 1095.4,972.458 1095.5,1005C 1093.75,1120.96 1089.25,1236.8 1082,1352.5C 1147.59,1305.26 1216.76,1263.43 1289.5,1227C 1317.9,1213.09 1347.56,1202.76 1378.5,1196C 1394.94,1192.34 1411.27,1192.67 1427.5,1197C 1440.47,1201.47 1448.81,1210.31 1452.5,1223.5C 1356.85,1326.32 1261.02,1428.98 1165,1531.5C 1058.3,1451.44 938.469,1401.94 805.5,1383C 750.108,1375.25 694.442,1371.42 638.5,1371.5C 592.507,1372.91 546.507,1373.41 500.5,1373C 490.312,1372.7 480.646,1370.36 471.5,1366C 469.622,1364.46 468.122,1362.62 467,1360.5C 463.645,1349.72 461.311,1338.72 460,1327.5C 452.49,1263.37 447.49,1199.03 445,1134.5C 441.096,1055.21 439.763,975.876 441,896.5C 441.187,867.647 443.521,838.98 448,810.5C 448.817,806.211 450.317,802.211 452.5,798.5 Z"/>
  </svg>
</div>

<!-- Header -->
<header class="header">
  <!-- Logo -->
  <a href="index.html" class="logo-link">
    <img src="https://i.imgur.com/Kl9kTBg.png" alt="Burban Logo" class="logo-img">
  </a>

  <!-- Nav desktop -->
  <nav class="nav">
    <a href="https://burbanofficial.com/index.html" class="nav-item active">Home</a>
    <a href="https://burbanofficial.com/shop.html" class="nav-item">Shop</a>
    <a href="https://burbanofficial.com/about-burban.html" class="nav-item">About Burban</a>
    <a href="https://burbanofficial.com/contact.html" class="nav-item">Contact Us</a>
  </nav>

  <!-- Icônes + hamburger -->
  <div class="actions">
    <a href="https://burbanofficial.com/account.html" class="account-btn" aria-label="Mon compte"><i class="fa-solid fa-user"></i></a>&nbsp;&nbsp;&nbsp;&nbsp;
    <a href="https://burbanofficial.com/public/index.html" class="cart-btn" aria-label="Mon panier"><i class="fa-solid fa-bag-shopping"></i></a>&nbsp;&nbsp;&nbsp;&nbsp;
    <button class="hamburger" aria-label="Ouvrir le menu">
      <span class="bar"></span>
      <span class="bar"></span>
      <span class="bar"></span>
    </button>
    <!-- <div class="lang-switcher desktop-lang">
      <select id="languageSelector" aria-label="Changer de langue">
        <option value="EN">EN</option>
        <option value="FR">FR</option>
      </select>
    </div> -->
  </div>
</header>

<!-- Overlay menu mobile -->
<div class="overlay-menu" id="overlayMenu">
  <button class="close-btn" aria-label="Fermer le menu">&times;</button>
  <ul class="overlay-nav">
    <li><a href="https://burbanofficial.com/index.html">Home</a></li>
    <li><a href="https://burbanofficial.com/shop.html">Shop</a></li>
    <li><a href="https://burbanofficial.com/about-burban.html">About Burban</a></li>
    <li><a href="https://burbanofficial.com/contact.html">Contact Us</a></li>
    <!-- <li class="mobile-lang">
      <label for="languageSelectorMobile">Language:</label>
      <select id="languageSelectorMobile" aria-label="Changer de langue">
        <option value="EN">EN</option>
        <option value="FR">FR</option>
      </select>
    </li> -->
  </ul>
</div>

  <div class="page-wrap">
    <main id="mainFrame" class="frame" role="main" aria-label="Espace client Burban">

      <!-- LEFT column: profile summary -->
      <aside class="glass profile-card" aria-labelledby="profile-heading">
        <div class="brand">
          <img src="https://i.imgur.com/CCC34mn.png" alt="Burban">
          <div>
            <h1 id="profile-heading">Burban</h1>
            <p>Official customer area</p>
          </div>
        </div>

        <div class="profile-top">
          <div class="avatar" id="avatar">RC</div>
          <div>
            <div class="profile-name" id="userName">Guest</div>
            <div class="profile-email" id="userEmail">—</div>
            <div class="flex" style="margin-top:8px">
              <button class="small-btn" id="openAuth">Sign in / Sign up</button>
              <a href="https://burbanofficial.com/shop.html" class="small-btn hidden"  id="logoutSmall"><i class="fa-solid fa-arrow-right-from-bracket"></i></a>
              <a href="https://burbanofficial.com/shop.html" class="small-btn" id="goShop">Back to website</a>
            </div>
          </div>
        </div>

        <div class="loyalty">
          <div>
            <div class="muted">Points</div>
            <div class="points" id="points">0</div>
          </div>
          <div class="progress-outer">
            <div class="progress-bar" aria-hidden="true"><i id="progressFill" style="width:0%"></i></div>
            <div class="markers">
              <span>0</span><span>500</span><span>1000</span><span>2500</span>
            </div>
          </div>
        </div>

        <div class="card" style="display:flex;flex-direction:column;gap:8px">
          <div class="muted">Quick actions</div>
          <div class="controls">
            <button class="btn" id="toOrders">My orders</button>
            <button class="btn" id="toFav">Favorites</button>
            <button class="btn" id="toSupport">Support</button>
          </div>
        </div>

        <div class="meta">Account created • <span id="createdAt">—</span></div>
      </aside>

      <!-- RIGHT column: content panels -->
      <section class="content">

        <div class="glass">
          <nav class="tabs" role="tablist" aria-label="Espace client onglets">
            <button class="tab-btn" role="tab" aria-selected="true" data-panel="profile">Profile</button>
            <button class="tab-btn" role="tab" aria-selected="false" data-panel="security">Security</button>
            <!-- <button class="tab-btn" role="tab" aria-selected="false" data-panel="favorites">Favorites</button> -->
            <button class="tab-btn" role="tab" aria-selected="false" data-panel="loyalty">My benefits</button>
            <button class="tab-btn" role="tab" aria-selected="false" data-panel="settings">Preferences</button>
          </nav>

          <div class="panel" id="panels">

            <!-- PROFILE PANEL -->
            <div class="card" id="profile" role="tabpanel">
              <h3 style="margin:0 0 8px">Profile</h3>
              <form id="profileForm" onsubmit="return false;">
                <div class="row">
                  <div class="col">
                    <label for="firstname">Firstname</label>
                    <input id="firstname" placeholder="Rémy" />
                  </div>
                  <div class="col">
                    <label for="lastname">Lastname</label>
                    <input id="lastname" placeholder="Cormon" />
                  </div>
                </div>
                <div style="margin-top:12px">
                  <label for="emailDisplay">Email</label>
                  <input id="emailDisplay" type="email" disabled />
                </div>
                <div style="margin-top:12px">
                  <label for="phone">Phone (optional)</label>
                  <input id="phone" placeholder="+33 6 12 34 56 78" />
                </div>

                <!-- Birthday field: editable only if not set -->
                <div style="margin-top:12px">
                  <label for="profileBirthday">Date of birth (optional)</label>
                  <input id="profileBirthday" type="date" style="color:#fff; -webkit-text-fill-color:#fff;" />
                  <div id="birthdayNote" class="birthday-note">Add your date of birth to receive a surprise on your special day.</div>
                </div>

                <div style="margin-top:12px;display:flex;gap:10px;align-items:center">
                  <button class="btn" id="saveProfile">Save changes</button>
                  <button class="btn ghost" id="downloadData">Download data</button>
                </div>
              </form>
            </div>

            <!-- SECURITY PANEL -->
            <div class="card" id="security" role="tabpanel" hidden>
              <h3 style="margin:0 0 8px">Security</h3>
              <form id="passwordForm" onsubmit="return false;">
                <label for="newPass">New password</label>
                <input id="newPass" type="password" autocomplete="new-password" />
                <label for="confirmPass">Confirm password</label>
                <input id="confirmPass" type="password" autocomplete="new-password" />
                <div style="margin-top:12px;display:flex;gap:10px">
                  <button class="btn" id="updatePassword">Update password</button>
                  <button class="btn-delete" id="resetPasswordBtn">Reset password (email)</button>
                </div>
              </form>
            </div>

            <!-- FAVORITES PANEL -->
            <div class="card" id="favorites" role="tabpanel" hidden>
            <h3 style="margin:0 0 8px">Favorites</h3>

            <!-- zone de contrôle / filtre (optionnel) -->
            <div style="display:flex;justify-content:space-between;align-items:center;gap:12px;margin-bottom:12px">
              <div class="muted">Your saved items</div>
              <div style="display:flex;gap:8px">
                <button class="btn-delete" id="clearFav">Clear favorites</button>
                <button class="btn ghost" id="refreshFav">Refresh</button>
              </div>
            </div>

            <!-- liste des favoris -->
            <div class="fav-list" id="favList" aria-live="polite">
              <!-- JS injecte ici les éléments -->
            </div>

            <!-- empty / fallback state -->
            <template id="fav-empty-template">
              <div class="muted center" style="padding:18px">
                You have no favorites yet — <a href="/shop.html" style="color:var(--accent);text-decoration:underline">go to shop</a> to add some.
              </div>
            </template>
          </div>

            <!-- LOYALTY PANEL -->
            <div class="card" id="loyalty" role="tabpanel" hidden>
              <h3 style="margin:0 0 8px">My Burban Benefits</h3>
              <p class="muted">Points convert to rewards. €1 = 10 pts.</p>
              <div style="display:flex;gap:18px;align-items:center;margin-top:12px;flex-wrap:wrap">
                <div style="min-width:120px;text-align:center">
                  <div style="font-size:26px;font-weight:800" id="coins">0</div>
                  <div class="muted">Coins</div>
                </div>
                <div style="flex:1">
                  <div class="progress-bar" aria-hidden><i id="loyaltyFill" style="width:0%"></i></div>
                  <div class="markers">
                    <span>0€</span><span>5€</span><span>10€</span><span>20€</span><span>30€</span>
                  </div>
                </div>
              </div>
              <div style="margin-top:14px" class="muted" id="nextReward">Next reward at 500 pts</div>
            </div>

            <!-- SETTINGS PANEL -->
            <div class="card" id="settings" role="tabpanel" hidden>
              <h3 style="margin:0 0 8px">Preferences</h3>
              <!-- <label for="lang">Language</label>
              <select id="lang"><option>FR</option><option>EN</option></select> -->
              <label style="margin-top:12px">Email preferences</label>

              <!-- Newsletter preference toggle (requires auth to change) -->
              <div style="display:flex;align-items:center;gap:12px;margin-top:8px">
                <div style="flex:1">
                  <div style="font-weight:600">Newsletter</div>
                  <div class="muted" style="font-size:13px">You may unsubscribe whenever you wish by simply clicking the link included in each of our emails.</div>
                </div>
                <!-- <button id="settingsNewsletterToggle" class="toggle-switch on" aria-pressed="true" title="Newsletter (Preferences)"><span class="track"></span><span class="knob"></span></button> -->
              </div>

              <div style="margin-top:14px"><button class="btn-delete" id="deleteAccount">Delete account</button></div>
            </div>

          </div>
        </div>

        <div class="meta">© Burban. All Rights Reserved</div>

      </section>

    </main>
  </div>

  <!-- AUTH MODAL -->
  <div class="modal" id="authModal" aria-hidden="true">
    <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="authTitle">
      <div class="auth-tabs">
        <div class="auth-tab active" data-mode="login">Log in</div>
        <div class="auth-tab" data-mode="register">Sign up</div>
      </div>

      <div id="authMessages"></div>

      <div id="loginForm">
        <input id="loginEmail" type="email" placeholder="Email address" />
        <input id="loginPassword" type="password" placeholder="Password" />
        <div style="display:flex;gap:8px;margin-top:8px">
          <button class="btn" id="btnLogin">Log in</button>
          <button class="btn-delete" id="forgotBtn">Forgot?</button>
        </div>
      </div>

      <div id="registerForm" class="hidden">
        <input id="regFirstname" placeholder="Firstname" />
        <input id="regLastname" placeholder="Lastname" />
        <input id="regEmail" type="email" placeholder="Email address" />
        <input id="regPassword" type="password" placeholder="Password (min 6)" />
        <label for="regBirthday" style="font-size:12px;color:var(--muted);margin-top:6px">Date of birth (optional — used for birthday surprise purposes)</label>
        <input id="regBirthday" type="date" />

        <!-- Indicatif + numéro -->
        <div style="display:flex;gap:8px;align-items:center;margin-top:6px">
          <div style="flex:0 0 120px">
            <label for="regCountryCode" style="font-size:12px;color:var(--muted);margin-bottom:6px;display:block">Indicatif</label>
            <select id="regCountryCode" class="country-select" aria-label="Indicatif">
  <option value="">Sélectionner un indicatif</option>
  <option value="+93">Afghanistan (+93)</option>
  <option value="+355">Albania (+355)</option>
  <option value="+213">Algeria (+213)</option>
  <option value="+1684">American Samoa (+1684)</option>
  <option value="+376">Andorra (+376)</option>
  <option value="+244">Angola (+244)</option>
  <option value="+1264">Anguilla (+1264)</option>
  <option value="+672">Antarctica (+672)</option>
  <option value="+1268">Antigua and Barbuda (+1268)</option>
  <option value="+54">Argentina (+54)</option>
  <option value="+374">Armenia (+374)</option>
  <option value="+297">Aruba (+297)</option>
  <option value="+61">Australia (+61)</option>
  <option value="+43">Austria (+43)</option>
  <option value="+994">Azerbaijan (+994)</option>
  <option value="+1242">Bahamas (+1242)</option>
  <option value="+973">Bahrain (+973)</option>
  <option value="+880">Bangladesh (+880)</option>
  <option value="+1246">Barbados (+1246)</option>
  <option value="+375">Belarus (+375)</option>
  <option value="+32">Belgium (+32)</option>
  <option value="+501">Belize (+501)</option>
  <option value="+229">Benin (+229)</option>
  <option value="+1441">Bermuda (+1441)</option>
  <option value="+975">Bhutan (+975)</option>
  <option value="+591">Bolivia (+591)</option>
  <option value="+387">Bosnia and Herzegovina (+387)</option>
  <option value="+267">Botswana (+267)</option>
  <option value="+55">Brazil (+55)</option>
  <option value="+246">British Indian Ocean Territory (+246)</option>
  <option value="+1284">British Virgin Islands (+1284)</option>
  <option value="+673">Brunei (+673)</option>
  <option value="+359">Bulgaria (+359)</option>
  <option value="+226">Burkina Faso (+226)</option>
  <option value="+257">Burundi (+257)</option>
  <option value="+855">Cambodia (+855)</option>
  <option value="+237">Cameroon (+237)</option>
  <option value="+1">Canada (+1)</option>
  <option value="+238">Cape Verde (+238)</option>
  <option value="+1345">Cayman Islands (+1345)</option>
  <option value="+236">Central African Republic (+236)</option>
  <option value="+235">Chad (+235)</option>
  <option value="+56">Chile (+56)</option>
  <option value="+86">China (+86)</option>
  <option value="+61">Christmas Island (+61)</option>
  <option value="+61">Cocos Islands (+61)</option>
  <option value="+57">Colombia (+57)</option>
  <option value="+269">Comoros (+269)</option>
  <option value="+682">Cook Islands (+682)</option>
  <option value="+506">Costa Rica (+506)</option>
  <option value="+385">Croatia (+385)</option>
  <option value="+53">Cuba (+53)</option>
  <option value="+599">Curacao (+599)</option>
  <option value="+357">Cyprus (+357)</option>
  <option value="+420">Czech Republic (+420)</option>
  <option value="+243">Democratic Republic of the Congo (+243)</option>
  <option value="+45">Denmark (+45)</option>
  <option value="+253">Djibouti (+253)</option>
  <option value="+1767">Dominica (+1767)</option>
  <option value="+1809">Dominican Republic (+1809)</option>
  <option value="+670">East Timor (+670)</option>
  <option value="+593">Ecuador (+593)</option>
  <option value="+20">Egypt (+20)</option>
  <option value="+503">El Salvador (+503)</option>
  <option value="+240">Equatorial Guinea (+240)</option>
  <option value="+291">Eritrea (+291)</option>
  <option value="+372">Estonia (+372)</option>
  <option value="+251">Ethiopia (+251)</option>
  <option value="+500">Falkland Islands (+500)</option>
  <option value="+298">Faroe Islands (+298)</option>
  <option value="+679">Fiji (+679)</option>
  <option value="+358">Finland (+358)</option>
  <option value="+33">France (+33)</option>
  <option value="+689">French Polynesia (+689)</option>
  <option value="+241">Gabon (+241)</option>
  <option value="+220">Gambia (+220)</option>
  <option value="+995">Georgia (+995)</option>
  <option value="+49">Germany (+49)</option>
  <option value="+233">Ghana (+233)</option>
  <option value="+350">Gibraltar (+350)</option>
  <option value="+30">Greece (+30)</option>
  <option value="+299">Greenland (+299)</option>
  <option value="+1473">Grenada (+1473)</option>
  <option value="+1671">Guam (+1671)</option>
  <option value="+502">Guatemala (+502)</option>
  <option value="+44-1481">Guernsey (+44-1481)</option>
  <option value="+224">Guinea (+224)</option>
  <option value="+245">Guinea-Bissau (+245)</option>
  <option value="+592">Guyana (+592)</option>
  <option value="+509">Haiti (+509)</option>
  <option value="+504">Honduras (+504)</option>
  <option value="+852">Hong Kong (+852)</option>
  <option value="+36">Hungary (+36)</option>
  <option value="+354">Iceland (+354)</option>
  <option value="+91">India (+91)</option>
  <option value="+62">Indonesia (+62)</option>
  <option value="+98">Iran (+98)</option>
  <option value="+964">Iraq (+964)</option>
  <option value="+353">Ireland (+353)</option>
  <option value="+44-1624">Isle of Man (+44-1624)</option>
  <option value="+972">Israel (+972)</option>
  <option value="+39">Italy (+39)</option>
  <option value="+225">Ivory Coast (+225)</option>
  <option value="+1876">Jamaica (+1876)</option>
  <option value="+81">Japan (+81)</option>
  <option value="+44-1534">Jersey (+44-1534)</option>
  <option value="+962">Jordan (+962)</option>
  <option value="+7">Kazakhstan (+7)</option>
  <option value="+254">Kenya (+254)</option>
  <option value="+686">Kiribati (+686)</option>
  <option value="+383">Kosovo (+383)</option>
  <option value="+965">Kuwait (+965)</option>
  <option value="+996">Kyrgyzstan (+996)</option>
  <option value="+856">Laos (+856)</option>
  <option value="+371">Latvia (+371)</option>
  <option value="+961">Lebanon (+961)</option>
  <option value="+266">Lesotho (+266)</option>
  <option value="+231">Liberia (+231)</option>
  <option value="+218">Libya (+218)</option>
  <option value="+423">Liechtenstein (+423)</option>
  <option value="+370">Lithuania (+370)</option>
  <option value="+352">Luxembourg (+352)</option>
  <option value="+853">Macau (+853)</option>
  <option value="+389">Macedonia (+389)</option>
  <option value="+261">Madagascar (+261)</option>
  <option value="+265">Malawi (+265)</option>
  <option value="+60">Malaysia (+60)</option>
  <option value="+960">Maldives (+960)</option>
  <option value="+223">Mali (+223)</option>
  <option value="+356">Malta (+356)</option>
  <option value="+692">Marshall Islands (+692)</option>
  <option value="+222">Mauritania (+222)</option>
  <option value="+230">Mauritius (+230)</option>
  <option value="+262">Mayotte (+262)</option>
  <option value="+52">Mexico (+52)</option>
  <option value="+691">Micronesia (+691)</option>
  <option value="+373">Moldova (+373)</option>
  <option value="+377">Monaco (+377)</option>
  <option value="+976">Mongolia (+976)</option>
  <option value="+382">Montenegro (+382)</option>
  <option value="+1664">Montserrat (+1664)</option>
  <option value="+212">Morocco (+212)</option>
  <option value="+258">Mozambique (+258)</option>
  <option value="+95">Myanmar (+95)</option>
  <option value="+264">Namibia (+264)</option>
  <option value="+674">Nauru (+674)</option>
  <option value="+977">Nepal (+977)</option>
  <option value="+31">Netherlands (+31)</option>
  <option value="+599">Netherlands Antilles (+599)</option>
  <option value="+687">New Caledonia (+687)</option>
  <option value="+64">New Zealand (+64)</option>
  <option value="+505">Nicaragua (+505)</option>
  <option value="+227">Niger (+227)</option>
  <option value="+234">Nigeria (+234)</option>
  <option value="+683">Niue (+683)</option>
  <option value="+850">North Korea (+850)</option>
  <option value="+1670">Northern Mariana Islands (+1670)</option>
  <option value="+47">Norway (+47)</option>
  <option value="+968">Oman (+968)</option>
  <option value="+92">Pakistan (+92)</option>
  <option value="+680">Palau (+680)</option>
  <option value="+970">Palestine (+970)</option>
  <option value="+507">Panama (+507)</option>
  <option value="+675">Papua New Guinea (+675)</option>
  <option value="+595">Paraguay (+595)</option>
  <option value="+51">Peru (+51)</option>
  <option value="+63">Philippines (+63)</option>
  <option value="+64">Pitcairn (+64)</option>
  <option value="+48">Poland (+48)</option>
  <option value="+351">Portugal (+351)</option>
  <option value="+1787">Puerto Rico (+1787)</option>
  <option value="+974">Qatar (+974)</option>
  <option value="+242">Republic of the Congo (+242)</option>
  <option value="+262">Reunion (+262)</option>
  <option value="+40">Romania (+40)</option>
  <option value="+7">Russia (+7)</option>
  <option value="+250">Rwanda (+250)</option>
  <option value="+590">Saint Barthelemy (+590)</option>
  <option value="+290">Saint Helena (+290)</option>
  <option value="+1869">Saint Kitts and Nevis (+1869)</option>
  <option value="+1758">Saint Lucia (+1758)</option>
  <option value="+590">Saint Martin (+590)</option>
  <option value="+508">Saint Pierre and Miquelon (+508)</option>
  <option value="+1784">Saint Vincent and the Grenadines (+1784)</option>
  <option value="+685">Samoa (+685)</option>
  <option value="+378">San Marino (+378)</option>
  <option value="+239">Sao Tome and Principe (+239)</option>
  <option value="+966">Saudi Arabia (+966)</option>
  <option value="+221">Senegal (+221)</option>
  <option value="+381">Serbia (+381)</option>
  <option value="+248">Seychelles (+248)</option>
  <option value="+232">Sierra Leone (+232)</option>
  <option value="+65">Singapore (+65)</option>
  <option value="+1721">Sint Maarten (+1721)</option>
  <option value="+421">Slovakia (+421)</option>
  <option value="+386">Slovenia (+386)</option>
  <option value="+677">Solomon Islands (+677)</option>
  <option value="+252">Somalia (+252)</option>
  <option value="+27">South Africa (+27)</option>
  <option value="+82">South Korea (+82)</option>
  <option value="+211">South Sudan (+211)</option>
  <option value="+34">Spain (+34)</option>
  <option value="+94">Sri Lanka (+94)</option>
  <option value="+249">Sudan (+249)</option>
  <option value="+597">Suriname (+597)</option>
  <option value="+47">Svalbard and Jan Mayen (+47)</option>
  <option value="+268">Swaziland (+268)</option>
  <option value="+46">Sweden (+46)</option>
  <option value="+41">Switzerland (+41)</option>
  <option value="+963">Syria (+963)</option>
  <option value="+886">Taiwan (+886)</option>
  <option value="+992">Tajikistan (+992)</option>
  <option value="+255">Tanzania (+255)</option>
  <option value="+66">Thailand (+66)</option>
  <option value="+228">Togo (+228)</option>
  <option value="+690">Tokelau (+690)</option>
  <option value="+676">Tonga (+676)</option>
  <option value="+1868">Trinidad and Tobago (+1868)</option>
  <option value="+216">Tunisia (+216)</option>
  <option value="+90">Turkey (+90)</option>
  <option value="+993">Turkmenistan (+993)</option>
  <option value="+1649">Turks and Caicos Islands (+1649)</option>
  <option value="+688">Tuvalu (+688)</option>
  <option value="+1340">U.S. Virgin Islands (+1340)</option>
  <option value="+256">Uganda (+256)</option>
  <option value="+380">Ukraine (+380)</option>
  <option value="+971">United Arab Emirates (+971)</option>
  <option value="+44">United Kingdom (+44)</option>
  <option value="+1">United States (+1)</option>
  <option value="+598">Uruguay (+598)</option>
  <option value="+998">Uzbekistan (+998)</option>
  <option value="+678">Vanuatu (+678)</option>
  <option value="+379">Vatican (+379)</option>
  <option value="+58">Venezuela (+58)</option>
  <option value="+84">Vietnam (+84)</option>
  <option value="+681">Wallis and Futuna (+681)</option>
  <option value="+212">Western Sahara (+212)</option>
  <option value="+967">Yemen (+967)</option>
  <option value="+260">Zambia (+260)</option>
  <option value="+263">Zimbabwe (+263)</option>
</select>
          </div>

          <div style="flex:1">
            <label for="regPhone" style="font-size:12px;color:var(--muted);margin-bottom:6px;display:block">Numéro (optionnel)</label>
            <input id="regPhone" type="tel" class="phone-input" placeholder="6 12 34 56 78" aria-label="Numéro de téléphone (sans l'indicatif)" />
          </div>
        </div>

        <!-- Toggle newsletter (registration)
        <div style="display:flex;align-items:center;gap:12px;margin-top:8px">
          <div style="flex:1">
            <div style="font-weight:600">Newsletter</div>
            <div class="muted" style="font-size:13px">Recevoir les communications marketing</div>
          </div>
          <button id="regNewsletterToggle" class="toggle-switch on" aria-pressed="true" title="S'inscrire à la newsletter"><span class="track"></span><span class="knob"></span></button>
        </div> -->

        <div style="display:flex;gap:8px;margin-top:8px">
          <button class="btn" id="btnRegister">Create account</button>
          <button class="btn-delete" id="btnCloseAuth">Close</button>
        </div>
      </div>

      <div class="center" style="margin-top:12px;font-size:12px;color:var(--muted)">
        By creating an account you accept our <button class="link-btn">Terms</button> and <button class="link-btn">Privacy</button>.
      </div>
    </div>
  </div>

  <!-- Firebase (compat) -->
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>

  <script>
  // -------------------- CONFIG --------------------
  const firebaseConfig = {
    apiKey: "AIzaSyDb4AOtRT7jGENnLZ2KNwpczaG2Z77G2rc",
    authDomain: "burban-fidelity.firebaseapp.com",
    projectId: "burban-fidelity",
    storageBucket: "burban-fidelity.firebasestorage.app",
    messagingSenderId: "830299174800",
    appId: "1:830299174800:web:f50a4ec419e108f7f16515",
    measurementId: "G-E4QD4PYLM5"
  };

  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();


  // -------------------- UI refs --------------------
  const authModal = document.getElementById('authModal');
  const openAuth = document.getElementById('openAuth');
  const logoutSmall = document.getElementById('logoutSmall');
  const btnLogin = document.getElementById('btnLogin');
  const btnRegister = document.getElementById('btnRegister');
  const authMessages = document.getElementById('authMessages');
  const mainFrame = document.getElementById('mainFrame');

  // profile refs
  const userName = document.getElementById('userName');
  const userEmail = document.getElementById('userEmail');
  const avatar = document.getElementById('avatar');
  const pointsEl = document.getElementById('points');
  const progressFill = document.getElementById('progressFill');
  const coins = document.getElementById('coins');
  const loyaltyFill = document.getElementById('loyaltyFill');
  const createdAt = document.getElementById('createdAt');

  // forms
  const loginEmail = document.getElementById('loginEmail');
  const loginPassword = document.getElementById('loginPassword');
  const regFirstname = document.getElementById('regFirstname');
  const regLastname = document.getElementById('regLastname');
  const regEmail = document.getElementById('regEmail');
  const regPassword = document.getElementById('regPassword');
  const regBirthday = document.getElementById('regBirthday');

  const firstnameInput = document.getElementById('firstname');
  const lastnameInput = document.getElementById('lastname');
  const emailDisplay = document.getElementById('emailDisplay');
  const phoneInput = document.getElementById('phone');
  const saveProfile = document.getElementById('saveProfile');
  const downloadData = document.getElementById('downloadData');
  const favList = document.getElementById('favList');
  const clearFav = document.getElementById('clearFav');
  const resetPasswordBtn = document.getElementById('resetPasswordBtn');
  const updatePassword = document.getElementById('updatePassword');
  const profileBirthday = document.getElementById('profileBirthday');
  const birthdayNote = document.getElementById('birthdayNote');

  // tabs
  const tabBtns = document.querySelectorAll('.tab-btn');
  const panels = document.querySelectorAll('[role="tabpanel"]');

  // ---------- New refs: phone + toggles ----------
  const regCountryCode = document.getElementById('regCountryCode');
  const regPhone = document.getElementById('regPhone');
  const regNewsletterToggle = document.getElementById('regNewsletterToggle');
  const settingsNewsletterToggle = document.getElementById('settingsNewsletterToggle');

  // auth tabs inside modal
  document.querySelectorAll('.auth-tab').forEach(tab => {
    tab.addEventListener('click', () => {
      document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
      tab.classList.add('active');
      const mode = tab.dataset.mode;
      document.getElementById('loginForm').classList.toggle('hidden', mode!=='login');
      document.getElementById('registerForm').classList.toggle('hidden', mode!=='register');
      authMessages.innerHTML = '';
    });
  });

  // open modal
  openAuth.addEventListener('click', () => { authModal.classList.add('active'); authModal.setAttribute('aria-hidden','false'); });
  document.getElementById('btnCloseAuth').addEventListener('click', ()=>{
    // only allow closing if user is authenticated
    if(auth.currentUser){ authModal.classList.remove('active'); authModal.setAttribute('aria-hidden','true'); }
    else{ showMessage('Please sign in to continue.'); }
  });

  // close modal on backdrop click: only if user authenticated
  authModal.addEventListener('click', (e)=>{ if(e.target===authModal && auth.currentUser){ authModal.classList.remove('active'); authModal.setAttribute('aria-hidden','true'); }});

  // lightweight tabs
  function setActive(panelId, btn){ panels.forEach(p=> p.hidden = (p.id !== panelId)); tabBtns.forEach(t=> t.setAttribute('aria-selected', t===btn ? 'true' : 'false')); }
  tabBtns.forEach(btn => { btn.addEventListener('click', ()=> setActive(btn.dataset.panel, btn)); });
  setActive('profile', document.querySelector('.tab-btn'));

  // -------------------- Helpers --------------------
  function showMessage(html, success=false){ authMessages.innerHTML = `<div class="${success? 'success':'alert'}">${html}</div>`; }
  function clearMessage(){ authMessages.innerHTML=''; }
  function setAvatarInitials(name){ const parts = (name||'').split(' '); const initials = (parts[0]||'').charAt(0) + ((parts[1]||'').charAt(0)||''); avatar.textContent = (initials||'G').toUpperCase(); }

  // -------------------- Auth actions --------------------
  btnRegister.addEventListener('click', async () => {
  clearMessage();
  const first = regFirstname.value.trim();
  const last = regLastname.value.trim();
  const email = regEmail.value.trim();
  const pass = regPassword.value;
  const birthday = regBirthday.value || '';
  if (!first || !last || !email || pass.length < 6) {
    showMessage('Please fill all fields and use a password of at least 6 characters.');
    return;
  }
  try {
    const cred = await auth.createUserWithEmailAndPassword(email, pass);
    // envoi du mail de vérif
    await cred.user.sendEmailVerification();

    // création du doc utilisateur (utilise ta fonction existante si présente)
    try {
      if (typeof createUserDocWithExtras === 'function') {
        await createUserDocWithExtras(cred.user.uid, first, last, email, birthday);
      } else {
        await db.collection('users').doc(cred.user.uid).set({
          firstname: first,
          lastname: last,
          email,
          birthday,
          favorites: [],
          points: 200,
          createdAt: firebase.firestore.FieldValue.serverTimestamp()
        });
      }
    } catch (e) { console.warn('create user doc failed', e); }

    // conserve la redirection post-login si elle existe (sinon définir le panier par défaut)
    try {
      if (!localStorage.getItem('postLoginRedirect')) {
        localStorage.setItem('postLoginRedirect', 'https://burbanofficial.com/public/index.html');
      }
    } catch(e){}

    // comme auparavant : on déconnecte pour forcer la vérif avant connexion
    try { await auth.signOut(); } catch(e){ console.warn('signOut after register failed', e); }

    showMessage('Account created. Verification email sent. Please verify your email before logging in.', true);
    // basculer sur le tab login (si tu as l'UI)
    const loginTab = document.querySelector('.auth-tab[data-mode="login"]');
    if (loginTab) loginTab.click();
  } catch (err) {
    console.error(err);
    showMessage(err.message || 'Registration error');
  }
});

  btnLogin.addEventListener('click', async () => {
  clearMessage();
  const email = loginEmail.value.trim();
  const pass = loginPassword.value;
  if (!email || !pass) { showMessage('Please enter email and password.'); return; }

  try {
    const cred = await auth.signInWithEmailAndPassword(email, pass);
    // assure fraîcheur
    await cred.user.reload();
    if (!cred.user.emailVerified) {
      // on déconnecte si pas vérifié (flux simple)
      try { await auth.signOut(); } catch(e){ console.warn(e); }
      showMessage('Please verify your email before logging in.');
      return;
    }

    // email vérifié → redirection si postLoginRedirect présent
    const stored = localStorage.getItem('postLoginRedirect');
    if (stored) {
      try { localStorage.removeItem('postLoginRedirect'); } catch(e){}
      window.location.href = stored;
      return;
    }

    // sinon on laisse le reste du flow faire son travail (auth.onAuthStateChanged)
    clearMessage();
  } catch (err) {
    console.error(err);
    showMessage(err.message || 'Login error');
  }
});

  // forgot password
  document.getElementById('forgotBtn').addEventListener('click', async ()=>{
    const email = loginEmail.value.trim() || prompt('Please enter your email for password reset:');
    if(!email) return;
    try{ await auth.sendPasswordResetEmail(email); showMessage('Password reset email sent.', true); }catch(err){ showMessage(err.message); }
  });

  // sign out
  logoutSmall.addEventListener('click', async ()=>{
    await auth.signOut();
    // onAuthStateChanged will re-open auth modal
  });

  // -------------------- Auth state handling: gate logic --------------------
  // Ensure the auth modal is shown before content when not authenticated
  // Start by locking UI until we know the state
  (function lockUI(){ mainFrame.style.pointerEvents='none'; mainFrame.style.opacity='0.55'; authModal.classList.add('active'); authModal.setAttribute('aria-hidden','false'); })();

  auth.onAuthStateChanged(async (user) => {
  // petit upgrade minimal : si utilisateur connecté + email vérifié + postLoginRedirect -> redirect
  if (user) {
    try { await user.reload(); } catch(e){ console.warn('user.reload failed', e); }

    // --- AJOUT UTM_EMAIL POUR KLAVIYO (sans double encodage) ---
    if (user.email) {
      const email = user.email.trim().toLowerCase();
      const url = new URL(window.location.href);

      // On ajoute l'email "brut", mais on remplace seulement & et ? pour ne pas casser l'URL
      const safeEmail = email.replace(/&/g, '%26').replace(/\?/g, '%3F');

      url.searchParams.set('utm_email', safeEmail);
      history.replaceState(null, '', url.toString());
      console.log('[Espace Client] utm_email ajouté à l’URL :', email);
    }
    // -------------------------------------

    if (user.emailVerified) {
      const stored = localStorage.getItem('postLoginRedirect');
      if (stored) {
        try { localStorage.removeItem('postLoginRedirect'); } catch(e){}
        if (window.location.href !== stored) {
          window.location.href = stored;
          return;
        }
      }
    }
  }

  // Ensuite, conserve ton comportement existant (affichage / lock UI / load profile)
  // Si tu avais dans ton fichier la logique qui suit, laisse-la telle quelle.
  // Exemple minimal (remets ici le code que tu avais avant pour montrer/masquer le modal) :
  if (user) {
    // utilisateur connecté et (selon ton flux) généralement vérifié à ce stade
    try {
      authModal.classList.remove('active'); authModal.setAttribute('aria-hidden','true');
      mainFrame.style.pointerEvents='auto'; mainFrame.style.opacity='1';
      openAuth.classList.add('hidden'); logoutSmall.classList.remove('hidden');
      loadUserProfile(user);
      loadUserFavorites(user);
      loadUserAdvantages(user);
    } catch(e){ console.warn(e); }
  } else {
    // pas d'utilisateur
    try {
      authModal.classList.add('active'); authModal.setAttribute('aria-hidden','false');
      mainFrame.style.pointerEvents='none'; mainFrame.style.opacity='0.55';
      openAuth.classList.remove('hidden'); logoutSmall.classList.add('hidden');
      userName.textContent = 'Guest'; userEmail.textContent = '—';
      setAvatarInitials('Guest'); pointsEl.textContent='0'; progressFill.style.width='0%'; coins.textContent='0'; loyaltyFill.style.width='0%'; createdAt.textContent='—'; favList.innerHTML='';
    } catch(e){ console.warn(e); }
  }
});

  // -------------------- Loaders --------------------
  async function loadUserProfile(user){
    try{
      const doc = await db.collection('users').doc(user.uid).get();
      if(doc.exists){
        const data = doc.data();
        userName.textContent = `${data.firstname || ''} ${data.lastname || ''}`.trim() || user.email;
        userEmail.textContent = data.email || user.email;
        setAvatarInitials(data.firstname + ' ' + data.lastname);
        firstnameInput.value = data.firstname || '';
        lastnameInput.value = data.lastname || '';
        emailDisplay.value = data.email || user.email;
        phoneInput.value = data.phone || '';

        // Birthday logic: if a birthday exists -> lock the field and show support note
        if(data.birthday){
          profileBirthday.value = data.birthday;
          profileBirthday.disabled = true;
          birthdayNote.className = 'birthday-locked';
          birthdayNote.innerHTML = 'Date of birth recorded. To modify it, contact the support (identity verification required).';
        } else {
          profileBirthday.value = '';
          profileBirthday.disabled = false;
          birthdayNote.className = 'birthday-note';
          birthdayNote.textContent = 'Add your date of birth to receive a surprise on your special day.';
        }

        if(data.createdAt && data.createdAt.toDate) createdAt.textContent = data.createdAt.toDate().toLocaleDateString();

        // apply phone & newsletter UI
        applyPhoneAndNewsletterToUI(data);
      }else{
        // fallback to basic info
        userName.textContent = user.email.split('@')[0]; userEmail.textContent = user.email; setAvatarInitials(user.email);
        profileBirthday.value = '';
        profileBirthday.disabled = false;
        birthdayNote.className = 'birthday-note';
        birthdayNote.textContent = 'Add your date of birth to receive a surprise on your special day.';
      }
    }catch(err){console.error(err)}
  }

  async function loadUserFavorites(user){
    try{
      const doc = await db.collection('users').doc(user.uid).get();
      const data = (doc.exists && doc.data()) || {};
      const favorites = data.favorites || [];
      favList.innerHTML = '';
      if(favorites.length===0){ favList.innerHTML = '<div class="muted">No favorites yet</div>'; }
      else{
        favorites.forEach(f => {
          const el = document.createElement('div'); el.className='fav-item'; el.innerHTML = `<div class="fav-thumb">IMG</div><div style="flex:1">${f}</div><div class="muted">—</div>`; favList.appendChild(el);
        });
      }
    }catch(err){console.error(err)}
  }

async function loadUserAdvantages(user){
try{
const doc = await db.collection('users').doc(user.uid).get();
const pts = (doc.exists && doc.data().points) || 0;
pointsEl.textContent = pts;

// progress relative to the maximum defined tier (2500 pts -> 30€)
const percent = Math.min(100, Math.round((pts / 2500) * 100));
progressFill.style.width = percent + '%';
coins.textContent = pts;
loyaltyFill.style.width = percent + '%';

// Paliers de récompense (pts -> libellé)
const thresholds = [
{ pts: 500, label: '5€' },
{ pts: 1000, label: '10€' },
{ pts: 2000, label: '20€' },
{ pts: 2500, label: '30€' }
];

// Cherche le prochain palier supérieur aux points actuels
const upcoming = thresholds.find(t => pts < t.pts);
if (upcoming) {
const missing = upcoming.pts - pts;
document.getElementById('nextReward').textContent = `Next reward: ${upcoming.label} — You are missing ${missing} pts`;
} else {
document.getElementById('nextReward').textContent = 'Congratulations — you have reached the highest tier (€30)!';
}
}catch(err){console.error(err)}
}

  // -------------------- Profile update --------------------
  saveProfile.addEventListener('click', async ()=>{
    const user = auth.currentUser; if(!user){ alert('Please sign in first'); return; }
    const newFirst = firstnameInput.value.trim(); const newLast = lastnameInput.value.trim(); const newPhone = phoneInput.value.trim();
    const newBirthday = profileBirthday.value;
    try{
      const updates = { firstname: newFirst, lastname: newLast, /* phone updated below */ };
      // Only set birthday if the field is enabled (meaning user had none before) and a value was provided
      if(!profileBirthday.disabled && newBirthday){ updates.birthday = newBirthday; }

      // apply basic updates
      await db.collection('users').doc(user.uid).update(updates);

      // save phone + newsletter state
      await saveProfilePhoneAndNewsletter(user.uid);

      userName.textContent = `${newFirst} ${newLast}`.trim(); setAvatarInitials(newFirst + ' ' + newLast);

      // If we just added a birthday, lock the field and change note
      if(updates.birthday){
        profileBirthday.disabled = true;
        birthdayNote.className = 'birthday-locked';
        birthdayNote.innerHTML = 'Date de naissance enregistrée. Pour la modifier, contactez <a href="mailto:support@burbanofficial.com">support@burbanofficial.com</a> (vérification d\'identité requise).';
      }

      alert('Profile updated');
    }catch(err){ console.error(err); alert('Error: '+err.message); }
  });

  // download user data (CSV)
  downloadData.addEventListener('click', async ()=>{
    const user = auth.currentUser; if(!user){ alert('Please sign in first'); return; }
    const doc = await db.collection('users').doc(user.uid).get();
    const data = doc.exists ? doc.data() : {};
    const csvRows = [ ['field','value'] ];
    for(const k in data){ csvRows.push([k, JSON.stringify(data[k])]); }
    const csv = csvRows.map(r=> r.map(c=> '"'+String(c).replace(/"/g,'""')+'"').join(',')).join('\n');
    const blob = new Blob([csv], { type: 'text/csv' });
    const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href = url; a.download = 'burban_user_data.csv'; a.click(); URL.revokeObjectURL(url);
  });

  // -------------------- Favorites management --------------------
  clearFav.addEventListener('click', async ()=>{
    const user = auth.currentUser; if(!user){ alert('Please sign in first'); return; }
    if(!confirm('Clear all favorites?')) return;
    try{ await db.collection('users').doc(user.uid).update({ favorites: [] }); loadUserFavorites(user); }catch(err){console.error(err)}
  });

  // -------------------- Password & reset --------------------
  updatePassword.addEventListener('click', async ()=>{
    const user = auth.currentUser; if(!user){ alert('Please sign in first'); return; }
    const newP = document.getElementById('newPass').value; const conf = document.getElementById('confirmPass').value;
    if(!newP || newP !== conf){ alert('Passwords must match'); return; }
    try{ await user.updatePassword(newP); alert('Password updated'); document.getElementById('passwordForm').reset(); }catch(err){ alert('Error: '+err.message); }
  });

  resetPasswordBtn.addEventListener('click', async ()=>{
    const email = auth.currentUser ? auth.currentUser.email : prompt('Enter your email to receive reset.') || '';
    if(!email) return; try{ await auth.sendPasswordResetEmail(email); alert('Reset email sent'); }catch(err){ alert(err.message); }
  });

  // -------------------- Delete account (UI-level) --------------------
  document.getElementById('deleteAccount').addEventListener('click', async ()=>{
    const user = auth.currentUser; if(!user) { alert('Sign in first'); return; }
    if(!confirm('Delete your account permanently? This action cannot be undone.')) return;
    try{
      // remove user doc then delete auth
      await db.collection('users').doc(user.uid).delete();
      await user.delete();
      alert('Account deleted');
    }catch(err){ alert('Error: '+err.message); }
  });

  // small route buttons
  // redirection document.getElementById('toFav').addEventListener('click', ()=> document.querySelector('[data-panel="favorites"]').click());
  document.getElementById('toFav').addEventListener('click', ()=> alert('Favorites view — coming soon'));
  document.getElementById('toSupport').addEventListener('click', ()=> alert('Contact: support@burbanofficial.com'));
  document.getElementById('toOrders').addEventListener('click', ()=> alert('Orders view — coming soon'));

  // quick demo: add favorite (for testing)
  function addFavoriteDemo(name){
    const user = auth.currentUser; if(!user){ alert('Sign in first'); return; }
    db.collection('users').doc(user.uid).update({ favorites: firebase.firestore.FieldValue.arrayUnion(name) }).then(()=> loadUserFavorites(user));
  }

  // expose for console debugging
  window.__burban = { auth, db, addFavoriteDemo };

  /* ---------- Formatage du numéro selon indicatif et toggles ---------- */
  /* Règles de groupement simples (tu peux étendre la map) */
  const phoneGrouping = {
    '+93': [2,3,4],
  '+355': [2,3,3],
  '+213': [2,3,3],
  '+1684': [3,3,4],      // American Samoa (use NANP style)
  '+376': [3,3],
  '+244': [2,3,3],
  '+1264': [3,3,4],
  '+672': [3,3,3],
  '+1268': [3,3,4],
  '+54': [2,4,4],
  '+374': [2,3,4],
  '+297': [3,4],
  '+61': [1,4,3],        // Australia (simplified)
  '+43': [3,3,4],
  '+994': [3,3,3],
  '+1242': [3,3,4],
  '+973': [3,3,3],
  '+880': [3,3,3],
  '+1246': [3,3,4],
  '+375': [2,3,3],
  '+32': [2,3,3],
  '+501': [3,3],
  '+229': [2,3,3],
  '+1441': [3,3,4],
  '+975': [2,2,4],
  '+591': [2,3,3],
  '+387': [3,3,3],
  '+267': [2,3,3],
  '+55': [2,4,4],
  '+246': [3,3],
  '+1284': [3,3,4],
  '+673': [3,3,3],
  '+359': [2,3,3],
  '+226': [2,2,2,2],
  '+257': [2,3,3],
  '+855': [2,3,3],
  '+237': [2,3,3],
  '+1': [3,3,4],         // NANP default (US/CA/territories)
  '+238': [3,3],
  '+1345': [3,3,4],
  '+236': [2,3,3],
  '+235': [2,3,3],
  '+56': [2,4,4],
  '+86': [3,4,4],
  '+57': [2,3,4],
  '+269': [2,3,2],
  '+682': [3,3],
  '+506': [2,2,2],
  '+385': [2,3,3],
  '+53': [2,3,3],
  '+599': [3,3],
  '+357': [2,3,3],
  '+420': [3,3,3],
  '+243': [2,3,3,2],
  '+45': [2,2,2],
  '+253': [2,3,3],
  '+1767': [3,3,4],
  '+1809': [3,3,4],
  '+670': [3,3],
  '+593': [2,3,3],
  '+20': [2,3,3],
  '+503': [3,3],
  '+240': [3,3,3],
  '+291': [2,3,3],
  '+372': [2,2,2,2],
  '+251': [2,3,3],
  '+500': [3,3],
  '+298': [2,3],
  '+679': [3,3,3],
  '+358': [2,2,2,2],
  '+33': [1,2,2,2,2],    // France
  '+689': [3,3],
  '+241': [2,3,3],
  '+220': [3,3],
  '+995': [3,3,3],
  '+49': [3,3,4],        // Germany (simplified)
  '+233': [3,3,3],
  '+350': [3,3],
  '+30': [2,3,3],
  '+299': [3,3],
  '+1473': [3,3,4],
  '+1671': [3,3,4],
  '+502': [2,3,3],
  '+224': [2,3,3],
  '+245': [2,3,3],
  '+592': [3,3],
  '+509': [2,3,2],
  '+504': [3,3],
  '+852': [4,4],
  '+36': [2,3,3],
  '+354': [2,2,2],
  '+91': [5,5],          // India (local variations; we show 5-5)
  '+62': [3,3,4],
  '+98': [2,3,3],
  '+964': [2,3,3,2],
  '+353': [2,3,3],
  '+972': [2,3,3],
  '+39': [3,3,4],
  '+225': [2,2,2,2],
  '+1876': [3,3,4],
  '+81': [2,2,4],
  '+962': [2,3,3],
  '+7': [3,3,4],         // Russia/Kazakhstan (NANP-like style)
  '+254': [2,3,3],
  '+686': [3,3],
  '+383': [2,3,3],
  '+965': [3,3,3],
  '+996': [3,3,3],
  '+856': [2,3,3],
  '+371': [2,2,2,2],
  '+961': [2,2,2],
  '+266': [3,3],
  '+231': [2,3,3],
  '+218': [2,3,3],
  '+423': [3,3],
  '+370': [2,2,2],
  '+352': [2,2,3],
  '+853': [4,4],
  '+389': [3,3,3],
  '+261': [2,3,3],
  '+265': [2,3,3],
  '+60': [2,2,3,3],
  '+960': [3,3],
  '+223': [2,3,3],
  '+356': [3,3],
  '+692': [3,3],
  '+222': [2,3,3],
  '+230': [2,3,3],
  '+262': [2,3,3],
  '+52': [2,4,4],
  '+691': [3,3],
  '+373': [2,3,3],
  '+377': [3,3],
  '+976': [2,2,3,3],
  '+382': [2,3,3],
  '+1664': [3,3,4],
  '+212': [2,2,3,3],
  '+258': [2,3,3],
  '+95': [2,2,3,3],
  '+264': [2,3,3],
  '+674': [3,3],
  '+977': [2,2,3,3],
  '+31': [2,3,3],
  '+687': [3,3],
  '+64': [1,3,3],
  '+505': [3,3],
  '+227': [2,3,3],
  '+234': [3,3,4],
  '+683': [3,3],
  '+850': [2,2,2,2],
  '+1670': [3,3,4],
  '+47': [2,2,2],
  '+968': [2,3,3],
  '+92': [3,3,4],
  '+680': [3,3],
  '+970': [2,3,3],
  '+507': [3,3],
  '+675': [3,3,3],
  '+595': [3,3,3],
  '+51': [2,3,3],
  '+63': [3,3,3],
  '+48': [2,3,3],
  '+351': [2,3,3],
  '+1787': [3,3,4],
  '+974': [3,3],
  '+242': [2,3,3],
  '+40': [2,3,3],
  '+250': [2,3,3],
  '+290': [3,3],
  '+1869': [3,3,4],
  '+1758': [3,3,4],
  '+508': [3,3],
  '+1784': [3,3,4],
  '+685': [3,3],
  '+378': [3,3],
  '+239': [3,3],
  '+966': [3,3,3],
  '+221': [2,3,3],
  '+381': [3,3,3],
  '+248': [3,3],
  '+232': [3,3],
  '+65': [4,4],
  '+1721': [3,3,4],
  '+421': [3,3,3],
  '+386': [2,3,3],
  '+677': [3,3],
  '+252': [2,3,3],
  '+27': [2,3,3],
  '+82': [2,4,4],
  '+211': [2,3,3],
  '+94': [2,3,3],
  '+249': [2,3,3],
  '+597': [3,3],
  '+268': [3,3],
  '+46': [2,2,2,2],
  '+41': [2,3,3],
  '+963': [1,3,3,3],
  '+886': [2,4,4],
  '+992': [3,3,3],
  '+255': [2,3,3],
  '+66': [2,3,3],
  '+228': [2,3,3],
  '+690': [3,3],
  '+676': [3,3],
  '+1868': [3,3,4],
  '+216': [2,3,3],
  '+90': [3,3,3],
  '+993': [3,3,3],
  '+1649': [3,3,4],
  '+688': [3,3],
  '+1340': [3,3,4],
  '+256': [2,3,3],
  '+380': [2,3,3],
  '+971': [3,3,3],
  '+598': [2,3,3],
  '+998': [2,3,3],
  '+678': [3,3],
  '+379': [3,3],
  '+58': [3,3,3],
  '+84': [2,3,3],
  '+681': [3,3],
  '+967': [2,3,3],
  '+260': [2,3,3],
  '+263': [2,3,3],
  'default': [3,3,3,3]
  };

  function digitsOnly(s){
    return (s||'').replace(/\D/g,'');
  }

  /* Normalize code for matching: "+44-1481" -> "+441481" */
function normalizeCode(code){
  if(!code) return '';
  const digits = String(code).replace(/\D/g, '');
  return digits ? ('+' + digits) : '';
}

/* Find best matching grouping by longest prefix match */
function getPhoneGroupingForCode(code){
  const norm = normalizeCode(code);
  if(!norm) return phoneGrouping['default'];
  let bestKey = 'default';
  let bestLen = 0;
  for(const key in phoneGrouping){
    const kn = normalizeCode(key);
    if(!kn) continue;
    if(norm.startsWith(kn) && kn.length > bestLen){
      bestLen = kn.length;
      bestKey = key;
    }
  }
  return phoneGrouping[bestKey] || phoneGrouping['default'];
}

  function formatLocalNumber(digits, code){
    if(!digits) return '';
    // remove leading 0 for countries that use it (FR)
    if(code === '+33' && digits.startsWith('0')) digits = digits.slice(1);
    const groups = phoneGrouping[code] || phoneGrouping['default'];
    let parts = [], pos=0;
    for(let g of groups){
      if(pos >= digits.length) break;
      parts.push(digits.substr(pos, g));
      pos += g;
    }
    if(pos < digits.length) parts.push(digits.substr(pos));
    return parts.join(' ');
  }

  /* sync format when user types in regPhone */
  regPhone && regPhone.addEventListener('input', (e)=>{
    const code = (regCountryCode && regCountryCode.value) || '+33';
    let d = digitsOnly(e.target.value);
    const formatted = formatLocalNumber(d, code);
    e.target.value = formatted;
  });

  /* if user changes country code, update placeholder & reformat */
  regCountryCode && regCountryCode.addEventListener('change', ()=>{
    const code = regCountryCode.value;
    const placeholders = {
      '+93': '07 12 345 678',
  '+355': '06 12 345 678',
  '+213': '05 12 345 678',
  '+1684': '684 123 4567',
  '+376': '312 345',
  '+244': '923 123 456',
  '+1264': '564 1234',
  '+672': '123 456 789',
  '+1268': '268 1234',
  '+54': '11 1234 5678',
  '+374': '10 123 456',
  '+297': '522 1234',
  '+61': '4 1234 5678',
  '+43': '650 123 4567',
  '+994': '50 123 4567',
  '+1242': '242 123 4567',
  '+973': '3600 1234',
  '+880': '171 234 5678',
  '+1246': '246 1234',
  '+375': '29 123 45 67',
  '+32': '0470 12 34 56',
  '+501': '610 1234',
  '+229': '912 34 567',
  '+1441': '441 123 4567',
  '+975': '17 12 3456',
  '+591': '7123 4567',
  '+387': '61 123 456',
  '+267': '71 123 456',
  '+55': '11 91234 5678',
  '+246': '369 1234',
  '+1284': '284 1234',
  '+673': '71 234 567',
  '+359': '87 123 4567',
  '+226': '70 12 34 56',
  '+257': '79 12 34 56',
  '+855': '12 345 678',
  '+237': '6 90 12 34 56',
  '+1': '202 555 0143',
  '+238': '991 12 34',
  '+1345': '345 1234',
  '+236': '70 12 34 56',
  '+235': '65 12 34 56',
  '+56': '9 1234 5678',
  '+86': '138 1234 5678',
  '+57': '300 123 4567',
  '+269': '32 12 345',
  '+682': '21 123',
  '+506': '6280 1234',
  '+385': '091 123 4567',
  '+53': '5 1234 5678',
  '+599': '318 1234',
  '+357': '99 123 456',
  '+420': '602 123 456',
  '+243': '812 123 456',
  '+45': '20 12 34 56',
  '+253': '77 123 456',
  '+1767': '767 1234',
  '+1809': '809 123 4567',
  '+670': '77 123 456',
  '+593': '99 123 4567',
  '+20': '0100 123 4567',
  '+503': '7777 1234',
  '+240': '222 123 456',
  '+291': '7 123 456',
  '+372': '5123 4567',
  '+251': '91 123 4567',
  '+500': '500 1234',
  '+298': '22 12 34',
  '+679': '771 2345',
  '+358': '040 123 4567',
  '+33': '6 12 34 56 78',
  '+689': '87 12 34 56',
  '+241': '06 12 34 56',
  '+220': '301 2345',
  '+995': '599 12 345',
  '+49': '0151 1234 5678',
  '+233': '024 123 4567',
  '+350': '54012',
  '+30': '69 1234 5678',
  '+299': '24 12 34',
  '+1473': '473 1234',
  '+1671': '671 1234',
  '+502': '5501 2345',
  '+224': '60 12 34 56',
  '+245': '91 12 34 56',
  '+592': '6 123 456',
  '+509': '34 12 345',
  '+504': '9999 1234',
  '+852': '9123 4567',
  '+36': '30 123 4567',
  '+354': '861 2345',
  '+91': '91234 56789',
  '+62': '812 3456 7890',
  '+98': '0912 345 6789',
  '+964': '7700 123 456',
  '+353': '083 123 4567',
  '+972': '050 123 4567',
  '+39': '333 123 4567',
  '+225': '01 23 45 67',
  '+1876': '876 123 4567',
  '+81': '090 1234 5678',
  '+962': '79 123 4567',
  '+7': '912 345 6789',
  '+254': '0712 345678',
  '+686': '740 1234',
  '+383': '45 123 456',
  '+965': '5555 1234',
  '+996': '555 123 456',
  '+856': '20 55 123 456',
  '+371': '2 12 3456',
  '+961': '70 123 456',
  '+266': '58 123 456',
  '+231': '77 123 456',
  '+218': '91 123 4567',
  '+423': '79 123 456',
  '+370': '612 34 567',
  '+352': '621 123 456',
  '+853': '6612 3456',
  '+389': '70 123 456',
  '+261': '32 12 345 67',
  '+265': '88 123 4567',
  '+60': '12 345 6789',
  '+960': '79 1234',
  '+223': '66 12 34 56',
  '+356': '79 123 456',
  '+692': '55 123',
  '+222': '24 12 34 56',
  '+230': '52 12 3456',
  '+262': '0692 12 34 56',
  '+52': '55 1234 5678',
  '+691': '350 123',
  '+373': '79 123 456',
  '+377': '6 12 34 56 78',
  '+976': '99 123 4567',
  '+382': '69 123 456',
  '+1664': '664 1234',
  '+212': '06 12 34 56 78',
  '+258': '82 123 4567',
  '+95': '09 123 4567',
  '+264': '81 123 4567',
  '+674': '55 123',
  '+977': '98 123 4567',
  '+31': '06 12 34 56 78',
  '+687': '75 12 34',
  '+64': '21 123 4567',
  '+505': '8888 1234',
  '+227': '97 12 34 56',
  '+234': '0803 123 4567',
  '+683': '55 123',
  '+850': '191 234 567',
  '+1670': '670 1234',
  '+47': '412 34 567',
  '+968': '9123 4567',
  '+92': '0300 1234567',
  '+680': '550 123',
  '+970': '0599 123456',
  '+507': '6123 4567',
  '+675': '72 123 456',
  '+595': '98 123 456',
  '+51': '912 345 678',
  '+63': '0912 345 6789',
  '+48': '512 345 678',
  '+351': '91 234 5678',
  '+1787': '787 123 4567',
  '+974': '55 123 456',
  '+242': '06 123 4567',
  '+40': '0721 123 456',
  '+250': '78 123 4567',
  '+290': '2 12 34',
  '+1869': '869 1234',
  '+1758': '758 1234',
  '+508': '05 86 12 34',
  '+1784': '784 1234',
  '+685': '74 12 345',
  '+378': '334 123 456',
  '+239': '91 2 34 56',
  '+966': '05 1234 5678',
  '+221': '77 123 4567',
  '+381': '061 123456',
  '+248': '2 51 23 45',
  '+232': '76 123 456',
  '+65': '9123 4567',
  '+1721': '721 1234',
  '+421': '091 123 4567',
  '+386': '031 123 456',
  '+677': '77 123',
  '+252': '61 123 4567',
  '+27': '071 123 4567',
  '+82': '010 1234 5678',
  '+211': '0912 345 678',
  '+94': '071 234 5678',
  '+249': '91 123 4567',
  '+597': '79 123 456',
  '+268': '72 123 456',
  '+46': '070 123 45 67',
  '+41': '079 123 45 67',
  '+963': '0991 234 567',
  '+886': '0912 345 678',
  '+992': '9 123 456 789',
  '+255': '0712 345 678',
  '+66': '081 234 5678',
  '+228': '90 12 34 56',
  '+690': '78 12 345',
  '+676': '77 12 345',
  '+1868': '868 1234',
  '+216': '20 123 456',
  '+90': '0532 123 4567',
  '+993': '62 123 4567',
  '+1649': '649 1234',
  '+688': '90 12 345',
  '+1340': '340 1234',
  '+256': '0772 123 456',
  '+380': '067 123 4567',
  '+971': '050 123 4567',
  '+598': '098 123 456',
  '+998': '90 123 4567',
  '+678': '55 123',
  '+379': '066 123 456',
  '+58': '0414 123 4567',
  '+84': '0912 123 456',
  '+681': '75 12 345',
  '+967': '711 234 567',
  '+260': '097 123 4567',
  '+263': '0772 123 456',
  'default': '123 456 789'
    };
    regPhone.placeholder = placeholders[code] || '6 12 34 56 78';
    const d = digitsOnly(regPhone.value || '');
    regPhone.value = formatLocalNumber(d, code);
  });

  /* helper to produce E.164 style string: '+' + country + digits (no spaces) */
  function buildE164(code, localDigits){
    const d = digitsOnly(localDigits || '');
    let normalized = d;
    if(code === '+33' && normalized.startsWith('0')) normalized = normalized.slice(1);
    return code + normalized;
  }

  // ---------- Map des pays francophones (indicatifs) + helper ----------
function getCountryFromCode(code){
  const francophoneMap = {
    '+33': 'France',
    '+32': 'Belgique',
    '+41': 'Suisse',
    '+1':  'Canada', // +1 covers US/Canada — on considère ici Canada FR possible
    '+225': "Côte d'Ivoire",
    '+221': "Sénégal",
    '+212': "Maroc",
    '+213': "Algérie",
    '+216': "Tunisie",
    '+352': "Luxembourg",
    '+377': "Monaco",
    '+237': "Cameroun",
    '+243': "RD Congo",
    '+242': "Congo",
    '+261': "Madagascar",
    '+226': "Burkina Faso",
    '+223': "Mali",
    '+224': "Guinée",
    '+228': "Togo",
    '+229': "Bénin",
    '+250': "Rwanda",
    '+257': "Burundi",
    '+236': "République centrafricaine",
    '+235': "Tchad"
    // tu peux étendre cette map si tu veux d'autres pays
  };
  return francophoneMap[code] || '';
}

  /* toggle helper */
  function toggleSwitchElem(btn, toState){
    if(!btn) return false;
    const isOn = (toState === undefined) ? btn.classList.contains('on') : toState;
    btn.classList.toggle('on', isOn);
    btn.classList.toggle('off', !isOn);
    btn.setAttribute('aria-pressed', !!isOn);
    return isOn;
  }

  /* Registration toggle (works before auth) */
  if(regNewsletterToggle){
    toggleSwitchElem(regNewsletterToggle, true); // default ON
    regNewsletterToggle.addEventListener('click', ()=>{
      const newState = !regNewsletterToggle.classList.contains('on');
      toggleSwitchElem(regNewsletterToggle, newState);
    });
  }

  /* Settings toggle (requires auth to persist) */
  if(settingsNewsletterToggle){
    // default true visually
    toggleSwitchElem(settingsNewsletterToggle, true);

    settingsNewsletterToggle.addEventListener('click', async ()=>{
      const user = auth.currentUser;
      if(!user){ alert('Veuillez vous connecter pour modifier cette préférence.'); return; }
      // optimistic toggle
      const prior = settingsNewsletterToggle.classList.contains('on');
      const newState = !prior;
      toggleSwitchElem(settingsNewsletterToggle, newState);
      try{
        await db.collection('users').doc(user.uid).update({ newsletter: newState });
      }catch(err){
        console.error(err);
        alert('Erreur: ' + err.message);
        // revert visual state on error
        toggleSwitchElem(settingsNewsletterToggle, prior);
      }
    });
  }

  /* create user doc helper (used by registration when creating Firestore doc) */
  async function createUserDocWithExtras(uid, first, last, email, birthday){
    const code = regCountryCode ? regCountryCode.value : '+33';
    const phoneE164 = regPhone && regPhone.value ? buildE164(code, regPhone.value) : '';
    const newsletterState = regNewsletterToggle ? regNewsletterToggle.classList.contains('on') : true;
    return db.collection('users').doc(uid).set({
      firstname: first,
      lastname: last,
      email,
      phone: phoneE164,
      birthday: birthday || '',
      newsletter: !!newsletterState,
      favorites: [],
      points: 200,
      createdAt: firebase.firestore.FieldValue.serverTimestamp()
    });
  }

  /* apply phone & newsletter UI after loading profile */
  async function applyPhoneAndNewsletterToUI(data){
    if(!data) return;
    if(data.phone){
      let phoneVal = String(data.phone);
      const knownCodes = ['+33','+44','+1','+49','+34','+39'];
      let detected = knownCodes.find(c => phoneVal.startsWith(c)) || '+33';
      const localDigits = phoneVal.replace(detected, '');
      if(regCountryCode) regCountryCode.value = detected;
      const formatted = formatLocalNumber(digitsOnly(localDigits), detected);
      if(phoneInput) phoneInput.value = formatted;
      if(regPhone) regPhone.value = formatted;
    } else {
      if(phoneInput) phoneInput.value = '';
      if(regPhone) regPhone.value = '';
    }

    const nState = (typeof data.newsletter === 'boolean') ? data.newsletter : true;
    if(settingsNewsletterToggle) toggleSwitchElem(settingsNewsletterToggle, nState);
    if(regNewsletterToggle) toggleSwitchElem(regNewsletterToggle, nState);
  }

  /* save phone & newsletter when profile saved */
  async function saveProfilePhoneAndNewsletter(userId){
    const code = regCountryCode ? regCountryCode.value : '+33';
    const local = phoneInput ? phoneInput.value : '';
    const phoneE164 = local ? buildE164(code, local) : '';
    const newsletterState = settingsNewsletterToggle ? settingsNewsletterToggle.classList.contains('on') : true;
    const updates = { phone: phoneE164, newsletter: !!newsletterState, country: getCountryFromCode(code) };
    await db.collection('users').doc(userId).update(updates);
  }

  </script>

  <script>
    // Mise à jour automatique de l'année
    document.getElementById('year').textContent = new Date().getFullYear();
</script>

<script>
    const hamburger = document.querySelector('.hamburger');
    const overlay = document.getElementById('overlayMenu');
    const closeBtn = overlay.querySelector('.close-btn');
  
    hamburger.addEventListener('click', () => {
      overlay.classList.add('open');
    });
    closeBtn.addEventListener('click', () => {
      overlay.classList.remove('open');
    });
</script>

<script>
  function handleLanguageChange(value) {
    if (value === 'EN') {
      window.location.href = 'https://burbanofficial.com/';
    } else if (value === 'FR') {
      window.location.href = 'https://burbanofficial.com/FR-fr/';
    }
  }

  document.getElementById('languageSelector').addEventListener('change', function () {
    handleLanguageChange(this.value);
  });

  document.getElementById('languageSelectorMobile').addEventListener('change', function () {
    handleLanguageChange(this.value);
  });
</script>

  <script>
const loader = document.getElementById('loader');
const path = loader.querySelector('path');

// Désactive le scroll pendant le chargement
document.body.style.overflow = 'hidden';

// Récupère la longueur totale du path SVG
const length = path.getTotalLength();

// Stocke cette longueur dans une variable CSS custom pour animation finale
path.style.setProperty('--length', length);

// Initialise animation boucle
path.style.strokeDasharray = 1500;
path.style.strokeDashoffset = 0;
loader.classList.add('loading'); // classe pour boucle d'animation

// Dès que la page est complètement chargée
window.addEventListener('load', () => {
  // Arrête l'animation boucle
  loader.classList.remove('loading');

  // Prépare animation finale complète
  path.style.strokeDasharray = length;
  path.style.strokeDashoffset = length;

  // Force reflow pour appliquer styles immédiatement
  void path.offsetWidth;

  // Ajoute classe 'draw' pour lancer animation dessin final
  loader.classList.add('draw');

  // Après la fin de l'animation dessin (3s ici), on fait disparaître le loader
  setTimeout(() => {
    loader.classList.add('fade-out');

    // Puis on enlève le loader, montre le contenu principal et réactive le scroll
    setTimeout(() => {
      loader.remove();
      document.body.style.overflow = 'auto'; // ✅ scroll réactivé
      const main = document.getElementById('main-content');
      if(main) main.style.opacity = '1';
    }, 1000);
  }, 3000);
});
</script>
<script src="https://burbanofficial.com/public/includes/footer.js"></script>
</body>
</html>


